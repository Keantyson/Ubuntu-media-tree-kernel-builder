From dbbf6975193207d2ddbf0317a634008326d3365f Mon Sep 17 00:00:00 2001
From: Brad Love <hidden@email.co>
Date: Thu, 29 Oct 2020 12:36:16 -0500
Subject: [PATCH 3/6] Apply build fixes to media tree

---
 drivers/media/cec/cec-api.c                           | 3 +++
 drivers/media/cec/core/cec-adap.c                     | 2 ++
 drivers/media/cec/core/cec-api.c                      | 2 ++
 drivers/media/cec/usb/pulse8/pulse8-cec.c             | 2 ++
 drivers/media/common/v4l2-tpg/v4l2-tpg-core.c         | 2 ++
 drivers/media/common/videobuf2/videobuf2-dma-contig.c | 2 ++
 drivers/media/common/videobuf2/videobuf2-dma-sg.c     | 2 ++
 drivers/media/common/videobuf2/videobuf2-v4l2.c       | 2 ++
 drivers/media/common/videobuf2/videobuf2-vmalloc.c    | 2 ++
 drivers/media/dvb-core/dvb_net.c                      | 2 ++
 drivers/media/dvb-core/dvbdev.c                       | 2 ++
 drivers/media/dvb-frontends/af9013.c                  | 2 ++
 drivers/media/dvb-frontends/bcm3510.c                 | 2 ++
 drivers/media/dvb-frontends/cxd2820r_core.c           | 1 +
 drivers/media/dvb-frontends/dib0090.c                 | 2 ++
 drivers/media/dvb-frontends/dib3000mb.c               | 2 ++
 drivers/media/dvb-frontends/dib7000p.c                | 2 ++
 drivers/media/dvb-frontends/drx39xyj/drxj.c           | 2 ++
 drivers/media/dvb-frontends/drxd_hard.c               | 2 ++
 drivers/media/dvb-frontends/drxk_hard.c               | 2 ++
 drivers/media/dvb-frontends/lg2160.c                  | 2 ++
 drivers/media/dvb-frontends/lgdt3306a.c               | 1 +
 drivers/media/dvb-frontends/lgdt330x.c                | 3 +++
 drivers/media/dvb-frontends/m88ds3103.c               | 2 ++
 drivers/media/dvb-frontends/mt352.c                   | 2 ++
 drivers/media/dvb-frontends/mxl5xx.c                  | 2 ++
 drivers/media/dvb-frontends/or51132.c                 | 2 ++
 drivers/media/dvb-frontends/s5h1411.c                 | 2 ++
 drivers/media/dvb-frontends/ts2020.c                  | 2 ++
 drivers/media/dvb-frontends/zl10353.c                 | 2 ++
 drivers/media/i2c/adv7180.c                           | 2 ++
 drivers/media/i2c/adv7604.c                           | 2 ++
 drivers/media/i2c/msp3400-kthreads.c                  | 2 ++
 drivers/media/i2c/ov6650.c                            | 2 ++
 drivers/media/i2c/ov9640.c                            | 2 ++
 drivers/media/i2c/s5c73m3/s5c73m3-ctrls.c             | 2 ++
 drivers/media/i2c/smiapp/smiapp-core.c                | 2 ++
 drivers/media/i2c/tda1997x.c                          | 2 ++
 drivers/media/i2c/tvp5150.c                           | 2 ++
 drivers/media/mc/mc-device.c                          | 2 ++
 drivers/media/pci/bt8xx/bttv-driver.c                 | 2 ++
 drivers/media/pci/bt8xx/bttv-input.c                  | 2 ++
 drivers/media/pci/cx18/cx18-i2c.c                     | 2 ++
 drivers/media/pci/cx23885/cx23885-cards.c             | 2 ++
 drivers/media/pci/cx23885/cx23885-dvb.c               | 2 ++
 drivers/media/pci/cx23885/cx23885-i2c.c               | 2 ++
 drivers/media/pci/cx88/cx88-cards.c                   | 2 ++
 drivers/media/pci/cx88/cx88-video.c                   | 2 ++
 drivers/media/pci/ddbridge/ddbridge-core.c            | 2 ++
 drivers/media/pci/ivtv/ivtv-driver.c                  | 2 ++
 drivers/media/pci/ivtv/ivtv-i2c.c                     | 2 ++
 drivers/media/pci/meye/meye.c                         | 2 ++
 drivers/media/pci/saa7134/saa7134-cards.c             | 2 ++
 drivers/media/pci/saa7134/saa7134-video.c             | 2 ++
 drivers/media/pci/saa7164/saa7164-dvb.c               | 2 ++
 drivers/media/pci/smipcie/smipcie-main.c              | 2 ++
 drivers/media/pci/solo6x10/solo6x10-core.c            | 2 ++
 drivers/media/pci/solo6x10/solo6x10-i2c.c             | 2 ++
 drivers/media/pci/ttpci/av7110.c                      | 2 ++
 drivers/media/pci/ttpci/av7110_hw.c                   | 2 ++
 drivers/media/pci/ttpci/av7110_ipack.c                | 1 +
 drivers/media/pci/ttpci/budget-av.c                   | 2 ++
 drivers/media/pci/ttpci/budget.c                      | 1 +
 drivers/media/platform/marvell-ccic/mcam-core.c       | 2 ++
 drivers/media/platform/via-camera.c                   | 2 ++
 drivers/media/radio/radio-si476x.c                    | 2 ++
 drivers/media/radio/si4713/si4713.c                   | 2 ++
 drivers/media/radio/tea575x.c                         | 2 ++
 drivers/media/rc/iguanair.c                           | 2 ++
 drivers/media/rc/ir-rc6-decoder.c                     | 2 ++
 drivers/media/rc/ir-sony-decoder.c                    | 2 ++
 drivers/media/rc/lirc_dev.c                           | 2 ++
 drivers/media/test-drivers/vicodec/vicodec-core.c     | 2 ++
 drivers/media/test-drivers/vimc/vimc-sensor.c         | 2 ++
 drivers/media/test-drivers/vivid/vivid-vbi-gen.c      | 2 ++
 drivers/media/tuners/fc0011.c                         | 1 +
 drivers/media/tuners/tda18271-fe.c                    | 2 ++
 drivers/media/tuners/xc5000.c                         | 2 ++
 drivers/media/usb/cpia2/cpia2_core.c                  | 2 ++
 drivers/media/usb/cx231xx/cx231xx-video.c             | 2 ++
 drivers/media/usb/dvb-usb-v2/af9015.c                 | 2 ++
 drivers/media/usb/dvb-usb-v2/af9035.c                 | 2 ++
 drivers/media/usb/dvb-usb-v2/anysee.c                 | 2 ++
 drivers/media/usb/dvb-usb-v2/gl861.c                  | 2 ++
 drivers/media/usb/dvb-usb-v2/lmedm04.c                | 1 +
 drivers/media/usb/dvb-usb-v2/mxl111sf-gpio.c          | 2 ++
 drivers/media/usb/dvb-usb-v2/rtl28xxu.c               | 2 ++
 drivers/media/usb/dvb-usb-v2/zd1301.c                 | 2 ++
 drivers/media/usb/dvb-usb/dib0700_devices.c           | 2 ++
 drivers/media/usb/dvb-usb/dw2102.c                    | 3 +++
 drivers/media/usb/em28xx/Makefile                     | 4 ++--
 drivers/media/usb/em28xx/em28xx-dvb.c                 | 2 +-
 drivers/media/usb/go7007/go7007-driver.c              | 2 ++
 drivers/media/usb/gspca/mr97310a.c                    | 2 ++
 drivers/media/usb/gspca/nw80x.c                       | 2 ++
 drivers/media/usb/gspca/ov519.c                       | 2 ++
 drivers/media/usb/gspca/sn9c20x.c                     | 2 ++
 drivers/media/usb/gspca/sunplus.c                     | 2 ++
 drivers/media/usb/gspca/xirlink_cit.c                 | 2 ++
 drivers/media/usb/gspca/zc3xx.c                       | 2 ++
 drivers/media/usb/pwc/pwc-v4l.c                       | 2 ++
 drivers/media/usb/siano/smsusb.c                      | 2 ++
 drivers/media/usb/uvc/uvc_video.c                     | 2 ++
 drivers/media/v4l2-core/v4l2-async.c                  | 2 ++
 drivers/media/v4l2-core/v4l2-ctrls.c                  | 2 ++
 drivers/media/v4l2-core/v4l2-fwnode.c                 | 2 ++
 drivers/media/v4l2-core/v4l2-i2c.c                    | 2 ++
 drivers/media/v4l2-core/v4l2-ioctl.c                  | 2 ++
 drivers/media/v4l2-core/videobuf-core.c               | 2 ++
 include/media/v4l2-dev.h                              | 3 ++-
 110 files changed, 216 insertions(+), 4 deletions(-)

diff --git a/drivers/media/cec/cec-api.c b/drivers/media/cec/cec-api.c
index 12d676484472..f52251e9b9cc 100644
--- a/drivers/media/cec/cec-api.c
+++ b/drivers/media/cec/cec-api.c
@@ -19,6 +19,9 @@
 #include <linux/version.h>
 
 #include <media/cec-pin.h>
+
+#include <media/compat.h>
+
 #include "cec-priv.h"
 #include "cec-pin-priv.h"
 
diff --git a/drivers/media/cec/core/cec-adap.c b/drivers/media/cec/core/cec-adap.c
index d5d5d28d0b36..22f0e3281eef 100644
--- a/drivers/media/cec/core/cec-adap.c
+++ b/drivers/media/cec/core/cec-adap.c
@@ -21,6 +21,8 @@
 #include <drm/drm_edid.h>
 #include <drm/drm_file.h>
 
+#include <media/compat.h>
+
 #include "cec-priv.h"
 
 static void cec_fill_msg_report_features(struct cec_adapter *adap,
diff --git a/drivers/media/cec/core/cec-api.c b/drivers/media/cec/core/cec-api.c
index a9ecfee6e591..f56de19ee74c 100644
--- a/drivers/media/cec/core/cec-api.c
+++ b/drivers/media/cec/core/cec-api.c
@@ -18,6 +18,8 @@
 #include <linux/uaccess.h>
 #include <linux/version.h>
 
+#include <media/compat.h>
+
 #include <media/cec-pin.h>
 #include "cec-priv.h"
 #include "cec-pin-priv.h"
diff --git a/drivers/media/cec/usb/pulse8/pulse8-cec.c b/drivers/media/cec/usb/pulse8/pulse8-cec.c
index e4d8446b87da..4b641988e457 100644
--- a/drivers/media/cec/usb/pulse8/pulse8-cec.c
+++ b/drivers/media/cec/usb/pulse8/pulse8-cec.c
@@ -41,6 +41,8 @@
 
 #include <media/cec.h>
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Hans Verkuil <hverkuil@xs4all.nl>");
 MODULE_DESCRIPTION("Pulse Eight HDMI CEC driver");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c b/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
index 7607b516a7c4..302a5e6e10e7 100644
--- a/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
+++ b/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
@@ -11,6 +11,8 @@
 #include <linux/module.h>
 #include <media/tpg/v4l2-tpg.h>
 
+#include <media/compat.h>
+
 /* Must remain in sync with enum tpg_pattern */
 const char * const tpg_pattern_strings[] = {
 	"75% Colorbar",
diff --git a/drivers/media/common/videobuf2/videobuf2-dma-contig.c b/drivers/media/common/videobuf2/videobuf2-dma-contig.c
index 2f3a5996d3fc..1a6a83d783ed 100644
--- a/drivers/media/common/videobuf2/videobuf2-dma-contig.c
+++ b/drivers/media/common/videobuf2/videobuf2-dma-contig.c
@@ -22,6 +22,8 @@
 #include <media/videobuf2-dma-contig.h>
 #include <media/videobuf2-memops.h>
 
+#include <media/compat.h>
+
 struct vb2_dc_buf {
 	struct device			*dev;
 	void				*vaddr;
diff --git a/drivers/media/common/videobuf2/videobuf2-dma-sg.c b/drivers/media/common/videobuf2/videobuf2-dma-sg.c
index f6db8bfb6573..35483bd8aa1d 100644
--- a/drivers/media/common/videobuf2/videobuf2-dma-sg.c
+++ b/drivers/media/common/videobuf2/videobuf2-dma-sg.c
@@ -22,6 +22,8 @@
 #include <media/videobuf2-memops.h>
 #include <media/videobuf2-dma-sg.h>
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 
diff --git a/drivers/media/common/videobuf2/videobuf2-v4l2.c b/drivers/media/common/videobuf2/videobuf2-v4l2.c
index 96d3b2b2aa31..c8f43592b003 100644
--- a/drivers/media/common/videobuf2/videobuf2-v4l2.c
+++ b/drivers/media/common/videobuf2/videobuf2-v4l2.c
@@ -33,6 +33,8 @@
 
 #include <media/videobuf2-v4l2.h>
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 
diff --git a/drivers/media/common/videobuf2/videobuf2-vmalloc.c b/drivers/media/common/videobuf2/videobuf2-vmalloc.c
index 66276a8d50b5..015f1f5638b6 100644
--- a/drivers/media/common/videobuf2/videobuf2-vmalloc.c
+++ b/drivers/media/common/videobuf2/videobuf2-vmalloc.c
@@ -22,6 +22,8 @@
 #include <media/videobuf2-vmalloc.h>
 #include <media/videobuf2-memops.h>
 
+#include <media/compat.h>
+
 struct vb2_vmalloc_buf {
 	void				*vaddr;
 	struct frame_vector		*vec;
diff --git a/drivers/media/dvb-core/dvb_net.c b/drivers/media/dvb-core/dvb_net.c
index 08021c2161b0..daf7da1c59fb 100644
--- a/drivers/media/dvb-core/dvb_net.c
+++ b/drivers/media/dvb-core/dvb_net.c
@@ -57,6 +57,8 @@
 #include <media/dvb_demux.h>
 #include <media/dvb_net.h>
 
+#include <media/compat.h>
+
 static inline __u32 iov_crc32( __u32 c, struct kvec *iov, unsigned int cnt )
 {
 	unsigned int j;
diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.c
index 90d589a7407b..25fa1a27a806 100644
--- a/drivers/media/dvb-core/dvbdev.c
+++ b/drivers/media/dvb-core/dvbdev.c
@@ -34,6 +34,8 @@
 #include <linux/mutex.h>
 #include <media/dvbdev.h>
 
+#include <media/compat.h>
+
 /* Due to enum tuner_pad_index */
 #include <media/tuner.h>
 
diff --git a/drivers/media/dvb-frontends/af9013.c b/drivers/media/dvb-frontends/af9013.c
index 7d7c341b2bd8..db3fc4fb9da4 100644
--- a/drivers/media/dvb-frontends/af9013.c
+++ b/drivers/media/dvb-frontends/af9013.c
@@ -10,6 +10,8 @@
 
 #include "af9013_priv.h"
 
+#include <media/compat.h>
+
 struct af9013_state {
 	struct i2c_client *client;
 	struct regmap *regmap;
diff --git a/drivers/media/dvb-frontends/bcm3510.c b/drivers/media/dvb-frontends/bcm3510.c
index da0ff7b44da4..02d8f0b51dc2 100644
--- a/drivers/media/dvb-frontends/bcm3510.c
+++ b/drivers/media/dvb-frontends/bcm3510.c
@@ -44,6 +44,8 @@
 #include "bcm3510.h"
 #include "bcm3510_priv.h"
 
+#include <media/compat.h>
+
 /* Max transfer size done by bcm3510_do_hab_cmd() function */
 #define MAX_XFER_SIZE	128
 
diff --git a/drivers/media/dvb-frontends/cxd2820r_core.c b/drivers/media/dvb-frontends/cxd2820r_core.c
index b1618339eec0..c8153edc744a 100644
--- a/drivers/media/dvb-frontends/cxd2820r_core.c
+++ b/drivers/media/dvb-frontends/cxd2820r_core.c
@@ -5,6 +5,7 @@
  * Copyright (C) 2010 Antti Palosaari <crope@iki.fi>
  */
 
+#include <media/compat.h>
 
 #include "cxd2820r_priv.h"
 
diff --git a/drivers/media/dvb-frontends/dib0090.c b/drivers/media/dvb-frontends/dib0090.c
index 6c45d91b1423..1b54eccbf34d 100644
--- a/drivers/media/dvb-frontends/dib0090.c
+++ b/drivers/media/dvb-frontends/dib0090.c
@@ -21,6 +21,8 @@
 #include "dib0090.h"
 #include "dibx000_common.h"
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 MODULE_PARM_DESC(debug, "turn on debugging (default: 0)");
diff --git a/drivers/media/dvb-frontends/dib3000mb.c b/drivers/media/dvb-frontends/dib3000mb.c
index 6fcdf7c2e562..e6ccb6853f96 100644
--- a/drivers/media/dvb-frontends/dib3000mb.c
+++ b/drivers/media/dvb-frontends/dib3000mb.c
@@ -29,6 +29,8 @@
 
 #include <media/dvb_frontend.h>
 
+#include <media/compat.h>
+
 #include "dib3000.h"
 #include "dib3000mb_priv.h"
 
diff --git a/drivers/media/dvb-frontends/dib7000p.c b/drivers/media/dvb-frontends/dib7000p.c
index ac07ad1cfbb7..5c052508ade3 100644
--- a/drivers/media/dvb-frontends/dib7000p.c
+++ b/drivers/media/dvb-frontends/dib7000p.c
@@ -19,6 +19,8 @@
 
 #include "dib7000p.h"
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 MODULE_PARM_DESC(debug, "turn on debugging (default: 0)");
diff --git a/drivers/media/dvb-frontends/drx39xyj/drxj.c b/drivers/media/dvb-frontends/drx39xyj/drxj.c
index 263314c91e14..203c35f83d97 100644
--- a/drivers/media/dvb-frontends/drx39xyj/drxj.c
+++ b/drivers/media/dvb-frontends/drx39xyj/drxj.c
@@ -68,6 +68,8 @@ INCLUDE FILES
 #include "drxj.h"
 #include "drxj_map.h"
 
+#include <media/compat.h>
+
 /*============================================================================*/
 /*=== DEFINES ================================================================*/
 /*============================================================================*/
diff --git a/drivers/media/dvb-frontends/drxd_hard.c b/drivers/media/dvb-frontends/drxd_hard.c
index 45f982863904..135970d1a9d1 100644
--- a/drivers/media/dvb-frontends/drxd_hard.c
+++ b/drivers/media/dvb-frontends/drxd_hard.c
@@ -18,6 +18,8 @@
 #include "drxd.h"
 #include "drxd_firm.h"
 
+#include <media/compat.h>
+
 #define DRX_FW_FILENAME_A2 "drxd-a2-1.1.fw"
 #define DRX_FW_FILENAME_B1 "drxd-b1-1.1.fw"
 
diff --git a/drivers/media/dvb-frontends/drxk_hard.c b/drivers/media/dvb-frontends/drxk_hard.c
index 6006c1f07549..805e99a83acc 100644
--- a/drivers/media/dvb-frontends/drxk_hard.c
+++ b/drivers/media/dvb-frontends/drxk_hard.c
@@ -23,6 +23,8 @@
 #include "drxk_hard.h"
 #include <media/dvb_math.h>
 
+#include <media/compat.h>
+
 static int power_down_dvbt(struct drxk_state *state, bool set_power_mode);
 static int power_down_qam(struct drxk_state *state);
 static int set_dvbt_standard(struct drxk_state *state,
diff --git a/drivers/media/dvb-frontends/lg2160.c b/drivers/media/dvb-frontends/lg2160.c
index f343066c297e..95ea3311e8a3 100644
--- a/drivers/media/dvb-frontends/lg2160.c
+++ b/drivers/media/dvb-frontends/lg2160.c
@@ -9,6 +9,8 @@
 #include <linux/dvb/frontend.h>
 #include "lg2160.h"
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 MODULE_PARM_DESC(debug, "set debug level (info=1, reg=2 (or-able))");
diff --git a/drivers/media/dvb-frontends/lgdt3306a.c b/drivers/media/dvb-frontends/lgdt3306a.c
index 9464b5a72040..087fabd624bc 100644
--- a/drivers/media/dvb-frontends/lgdt3306a.c
+++ b/drivers/media/dvb-frontends/lgdt3306a.c
@@ -17,6 +17,7 @@
 #include "lgdt3306a.h"
 #include <linux/i2c-mux.h>
 
+#include <media/compat.h>
 
 static int debug;
 module_param(debug, int, 0644);
diff --git a/drivers/media/dvb-frontends/lgdt330x.c b/drivers/media/dvb-frontends/lgdt330x.c
index da3a8c5e18d8..401db5342c80 100644
--- a/drivers/media/dvb-frontends/lgdt330x.c
+++ b/drivers/media/dvb-frontends/lgdt330x.c
@@ -29,6 +29,9 @@
 
 #include <media/dvb_frontend.h>
 #include <media/dvb_math.h>
+
+#include <media/compat.h>
+
 #include "lgdt330x_priv.h"
 #include "lgdt330x.h"
 
diff --git a/drivers/media/dvb-frontends/m88ds3103.c b/drivers/media/dvb-frontends/m88ds3103.c
index ad6d9d564a87..4c299952708c 100644
--- a/drivers/media/dvb-frontends/m88ds3103.c
+++ b/drivers/media/dvb-frontends/m88ds3103.c
@@ -5,6 +5,8 @@
  * Copyright (C) 2013 Antti Palosaari <crope@iki.fi>
  */
 
+#include <media/compat.h>
+
 #include "m88ds3103_priv.h"
 
 static const struct dvb_frontend_ops m88ds3103_ops;
diff --git a/drivers/media/dvb-frontends/mt352.c b/drivers/media/dvb-frontends/mt352.c
index 399d5c519027..cae0d8c34542 100644
--- a/drivers/media/dvb-frontends/mt352.c
+++ b/drivers/media/dvb-frontends/mt352.c
@@ -27,6 +27,8 @@
 #include "mt352_priv.h"
 #include "mt352.h"
 
+#include <media/compat.h>
+
 struct mt352_state {
 	struct i2c_adapter* i2c;
 	struct dvb_frontend frontend;
diff --git a/drivers/media/dvb-frontends/mxl5xx.c b/drivers/media/dvb-frontends/mxl5xx.c
index 0b00a23436ed..fac77a63dd42 100644
--- a/drivers/media/dvb-frontends/mxl5xx.c
+++ b/drivers/media/dvb-frontends/mxl5xx.c
@@ -37,6 +37,8 @@
 #include "mxl5xx_regs.h"
 #include "mxl5xx_defs.h"
 
+#include <media/compat.h>
+
 #define BYTE0(v) ((v >>  0) & 0xff)
 #define BYTE1(v) ((v >>  8) & 0xff)
 #define BYTE2(v) ((v >> 16) & 0xff)
diff --git a/drivers/media/dvb-frontends/or51132.c b/drivers/media/dvb-frontends/or51132.c
index 24de1b115158..f7ec1543c0cf 100644
--- a/drivers/media/dvb-frontends/or51132.c
+++ b/drivers/media/dvb-frontends/or51132.c
@@ -31,6 +31,8 @@
 #include <media/dvb_frontend.h>
 #include "or51132.h"
 
+#include <media/compat.h>
+
 static int debug;
 #define dprintk(args...) \
 	do { \
diff --git a/drivers/media/dvb-frontends/s5h1411.c b/drivers/media/dvb-frontends/s5h1411.c
index c1334d7eb442..8f84bcc8358e 100644
--- a/drivers/media/dvb-frontends/s5h1411.c
+++ b/drivers/media/dvb-frontends/s5h1411.c
@@ -16,6 +16,8 @@
 #include <media/dvb_frontend.h>
 #include "s5h1411.h"
 
+#include <media/compat.h>
+
 struct s5h1411_state {
 
 	struct i2c_adapter *i2c;
diff --git a/drivers/media/dvb-frontends/ts2020.c b/drivers/media/dvb-frontends/ts2020.c
index 234607b02edb..2c6a18a13cd9 100644
--- a/drivers/media/dvb-frontends/ts2020.c
+++ b/drivers/media/dvb-frontends/ts2020.c
@@ -12,6 +12,8 @@
 #include <linux/regmap.h>
 #include <linux/math64.h>
 
+#include <media/compat.h>
+
 #define TS2020_XTAL_FREQ   27000 /* in kHz */
 #define FREQ_OFFSET_LOW_SYM_RATE 3000
 
diff --git a/drivers/media/dvb-frontends/zl10353.c b/drivers/media/dvb-frontends/zl10353.c
index 2a2cf20a73d6..978b7a3f336b 100644
--- a/drivers/media/dvb-frontends/zl10353.c
+++ b/drivers/media/dvb-frontends/zl10353.c
@@ -17,6 +17,8 @@
 #include "zl10353_priv.h"
 #include "zl10353.h"
 
+#include <media/compat.h>
+
 struct zl10353_state {
 	struct i2c_adapter *i2c;
 	struct dvb_frontend frontend;
diff --git a/drivers/media/i2c/adv7180.c b/drivers/media/i2c/adv7180.c
index 4498d14d3429..b45c9c0d2fd8 100644
--- a/drivers/media/i2c/adv7180.c
+++ b/drivers/media/i2c/adv7180.c
@@ -22,6 +22,8 @@
 #include <linux/mutex.h>
 #include <linux/delay.h>
 
+#include <media/compat.h>
+
 #define ADV7180_STD_AD_PAL_BG_NTSC_J_SECAM		0x0
 #define ADV7180_STD_AD_PAL_BG_NTSC_J_SECAM_PED		0x1
 #define ADV7180_STD_AD_PAL_N_NTSC_J_SECAM		0x2
diff --git a/drivers/media/i2c/adv7604.c b/drivers/media/i2c/adv7604.c
index 09004d928d11..cf5d7d7a7576 100644
--- a/drivers/media/i2c/adv7604.c
+++ b/drivers/media/i2c/adv7604.c
@@ -37,6 +37,8 @@
 #include <media/v4l2-dv-timings.h>
 #include <media/v4l2-fwnode.h>
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 MODULE_PARM_DESC(debug, "debug level (0-2)");
diff --git a/drivers/media/i2c/msp3400-kthreads.c b/drivers/media/i2c/msp3400-kthreads.c
index 52e506f86de5..75e5037c1e53 100644
--- a/drivers/media/i2c/msp3400-kthreads.c
+++ b/drivers/media/i2c/msp3400-kthreads.c
@@ -17,6 +17,8 @@
 #include <linux/suspend.h>
 #include "msp3400-driver.h"
 
+#include <media/compat.h>
+
 /* this one uses the automatic sound standard detection of newer msp34xx
    chip versions */
 static struct {
diff --git a/drivers/media/i2c/ov6650.c b/drivers/media/i2c/ov6650.c
index d73f9f540932..038c5b9fa5a9 100644
--- a/drivers/media/i2c/ov6650.c
+++ b/drivers/media/i2c/ov6650.c
@@ -32,6 +32,8 @@
 #include <media/v4l2-ctrls.h>
 #include <media/v4l2-device.h>
 
+#include <media/compat.h>
+
 /* Register definitions */
 #define REG_GAIN		0x00	/* range 00 - 3F */
 #define REG_BLUE		0x01
diff --git a/drivers/media/i2c/ov9640.c b/drivers/media/i2c/ov9640.c
index e2a25240fc85..60bb65aebdbc 100644
--- a/drivers/media/i2c/ov9640.c
+++ b/drivers/media/i2c/ov9640.c
@@ -36,6 +36,8 @@
 
 #include "ov9640.h"
 
+#include <media/compat.h>
+
 #define to_ov9640_sensor(sd)	container_of(sd, struct ov9640_priv, subdev)
 
 /* default register setup */
diff --git a/drivers/media/i2c/s5c73m3/s5c73m3-ctrls.c b/drivers/media/i2c/s5c73m3/s5c73m3-ctrls.c
index 141ad0ba7f5a..38d7606f4e84 100644
--- a/drivers/media/i2c/s5c73m3/s5c73m3-ctrls.c
+++ b/drivers/media/i2c/s5c73m3/s5c73m3-ctrls.c
@@ -28,6 +28,8 @@
 
 #include "s5c73m3.h"
 
+#include <media/compat.h>
+
 static int s5c73m3_get_af_status(struct s5c73m3 *state, struct v4l2_ctrl *ctrl)
 {
 	u16 reg = REG_AF_STATUS_UNFOCUSED;
diff --git a/drivers/media/i2c/smiapp/smiapp-core.c b/drivers/media/i2c/smiapp/smiapp-core.c
index 0917c9c29590..5cc2fad119d6 100644
--- a/drivers/media/i2c/smiapp/smiapp-core.c
+++ b/drivers/media/i2c/smiapp/smiapp-core.c
@@ -29,6 +29,8 @@
 
 #include "smiapp.h"
 
+#include <media/compat.h>
+
 #define SMIAPP_ALIGN_DIM(dim, flags)	\
 	((flags) & V4L2_SEL_FLAG_GE	\
 	 ? ALIGN((dim), 2)		\
diff --git a/drivers/media/i2c/tda1997x.c b/drivers/media/i2c/tda1997x.c
index a09bf0a39d05..39251a476e53 100644
--- a/drivers/media/i2c/tda1997x.c
+++ b/drivers/media/i2c/tda1997x.c
@@ -32,6 +32,8 @@
 
 #include "tda1997x_regs.h"
 
+#include <media/compat.h>
+
 #define TDA1997X_MBUS_CODES	5
 
 /* debug level */
diff --git a/drivers/media/i2c/tvp5150.c b/drivers/media/i2c/tvp5150.c
index 7d9401219a3a..ce3881681880 100644
--- a/drivers/media/i2c/tvp5150.c
+++ b/drivers/media/i2c/tvp5150.c
@@ -25,6 +25,8 @@
 
 #include "tvp5150_reg.h"
 
+#include <media/compat.h>
+
 #define TVP5150_H_MAX		720U
 #define TVP5150_V_MAX_525_60	480U
 #define TVP5150_V_MAX_OTHERS	576U
diff --git a/drivers/media/mc/mc-device.c b/drivers/media/mc/mc-device.c
index 6f0369bc5803..cd7b8eb591f6 100644
--- a/drivers/media/mc/mc-device.c
+++ b/drivers/media/mc/mc-device.c
@@ -24,6 +24,8 @@
 #include <media/media-entity.h>
 #include <media/media-request.h>
 
+#include <media/compat.h>
+
 #ifdef CONFIG_MEDIA_CONTROLLER
 
 /*
diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.c
index 6d8a5ada4f90..19d03c78aeca 100644
--- a/drivers/media/pci/bt8xx/bttv-driver.c
+++ b/drivers/media/pci/bt8xx/bttv-driver.c
@@ -49,6 +49,8 @@
 
 #include <media/i2c/saa6588.h>
 
+#include <media/compat.h>
+
 #define BTTV_VERSION "0.9.19"
 
 unsigned int bttv_num;			/* number of Bt848s in use */
diff --git a/drivers/media/pci/bt8xx/bttv-input.c b/drivers/media/pci/bt8xx/bttv-input.c
index 1bf8fe4194b5..18b588801adb 100644
--- a/drivers/media/pci/bt8xx/bttv-input.c
+++ b/drivers/media/pci/bt8xx/bttv-input.c
@@ -15,6 +15,8 @@
 #include <linux/input.h>
 #include <linux/slab.h>
 
+#include <media/compat.h>
+
 #include "bttv.h"
 #include "bttvp.h"
 
diff --git a/drivers/media/pci/cx18/cx18-i2c.c b/drivers/media/pci/cx18/cx18-i2c.c
index a83435245251..0fe3e2921476 100644
--- a/drivers/media/pci/cx18/cx18-i2c.c
+++ b/drivers/media/pci/cx18/cx18-i2c.c
@@ -8,6 +8,8 @@
  *  Copyright (C) 2008  Andy Walls <awalls@md.metrocast.net>
  */
 
+#include <media/compat.h>
+
 #include "cx18-driver.h"
 #include "cx18-io.h"
 #include "cx18-cards.h"
diff --git a/drivers/media/pci/cx23885/cx23885-cards.c b/drivers/media/pci/cx23885/cx23885-cards.c
index 03eee606af91..25a112bd190a 100644
--- a/drivers/media/pci/cx23885/cx23885-cards.c
+++ b/drivers/media/pci/cx23885/cx23885-cards.c
@@ -23,6 +23,8 @@
 #include "xc5000.h"
 #include "cx23888-ir.h"
 
+#include <media/compat.h>
+
 static unsigned int netup_card_rev = 4;
 module_param(netup_card_rev, int, 0644);
 MODULE_PARM_DESC(netup_card_rev,
diff --git a/drivers/media/pci/cx23885/cx23885-dvb.c b/drivers/media/pci/cx23885/cx23885-dvb.c
index 45c2f4afceb8..94e0ec49a999 100644
--- a/drivers/media/pci/cx23885/cx23885-dvb.c
+++ b/drivers/media/pci/cx23885/cx23885-dvb.c
@@ -17,6 +17,8 @@
 
 #include <media/v4l2-common.h>
 
+#include <media/compat.h>
+
 #include <media/dvb_ca_en50221.h>
 #include "s5h1409.h"
 #include "s5h1411.h"
diff --git a/drivers/media/pci/cx23885/cx23885-i2c.c b/drivers/media/pci/cx23885/cx23885-i2c.c
index f51fad33dc04..f9fa9e97532c 100644
--- a/drivers/media/pci/cx23885/cx23885-i2c.c
+++ b/drivers/media/pci/cx23885/cx23885-i2c.c
@@ -14,6 +14,8 @@
 
 #include <media/v4l2-common.h>
 
+#include <media/compat.h>
+
 static unsigned int i2c_debug;
 module_param(i2c_debug, int, 0644);
 MODULE_PARM_DESC(i2c_debug, "enable debug messages [i2c]");
diff --git a/drivers/media/pci/cx88/cx88-cards.c b/drivers/media/pci/cx88/cx88-cards.c
index 8e224fc0474d..75c5b570a476 100644
--- a/drivers/media/pci/cx88/cx88-cards.c
+++ b/drivers/media/pci/cx88/cx88-cards.c
@@ -16,6 +16,8 @@
 #include <linux/delay.h>
 #include <linux/slab.h>
 
+#include <media/compat.h>
+
 static unsigned int tuner[] = {[0 ... (CX88_MAXBOARDS - 1)] = UNSET };
 static unsigned int radio[] = {[0 ... (CX88_MAXBOARDS - 1)] = UNSET };
 static unsigned int card[]  = {[0 ... (CX88_MAXBOARDS - 1)] = UNSET };
diff --git a/drivers/media/pci/cx88/cx88-video.c b/drivers/media/pci/cx88/cx88-video.c
index 8cffdacf6007..339982bb0847 100644
--- a/drivers/media/pci/cx88/cx88-video.c
+++ b/drivers/media/pci/cx88/cx88-video.c
@@ -31,6 +31,8 @@
 #include <media/v4l2-event.h>
 #include <media/i2c/wm8775.h>
 
+#include <media/compat.h>
+
 MODULE_DESCRIPTION("v4l2 driver module for cx2388x based TV cards");
 MODULE_AUTHOR("Gerd Knorr <kraxel@bytesex.org> [SuSE Labs]");
 MODULE_LICENSE("GPL v2");
diff --git a/drivers/media/pci/ddbridge/ddbridge-core.c b/drivers/media/pci/ddbridge/ddbridge-core.c
index 92fe051c672f..2d5d9586f3e6 100644
--- a/drivers/media/pci/ddbridge/ddbridge-core.c
+++ b/drivers/media/pci/ddbridge/ddbridge-core.c
@@ -52,6 +52,8 @@
 #include "cxd2099.h"
 #include "ddbridge-dummy-fe.h"
 
+#include <media/compat.h>
+
 /****************************************************************************/
 
 #define DDB_MAX_ADAPTER 64
diff --git a/drivers/media/pci/ivtv/ivtv-driver.c b/drivers/media/pci/ivtv/ivtv-driver.c
index 28acb14490d5..8b9478cd8e7e 100644
--- a/drivers/media/pci/ivtv/ivtv-driver.c
+++ b/drivers/media/pci/ivtv/ivtv-driver.c
@@ -60,6 +60,8 @@
 #include "tuner-xc2028.h"
 #include <uapi/linux/sched/types.h>
 
+#include <media/compat.h>
+
 /* If you have already X v4l cards, then set this to X. This way
    the device numbers stay matched. Example: you have a WinTV card
    without radio and a PVR-350 with. Normally this would give a
diff --git a/drivers/media/pci/ivtv/ivtv-i2c.c b/drivers/media/pci/ivtv/ivtv-i2c.c
index 982045c4eea8..4a66cb633cdd 100644
--- a/drivers/media/pci/ivtv/ivtv-i2c.c
+++ b/drivers/media/pci/ivtv/ivtv-i2c.c
@@ -53,6 +53,8 @@
 #include "ivtv-i2c.h"
 #include <media/drv-intf/cx25840.h>
 
+#include <media/compat.h>
+
 /* i2c implementation for cx23415/6 chip, ivtv project.
  * Author: Kevin Thayer (nufan_wfk at yahoo.com)
  */
diff --git a/drivers/media/pci/meye/meye.c b/drivers/media/pci/meye/meye.c
index 8944e4bd4638..dc1bc6ae4f14 100644
--- a/drivers/media/pci/meye/meye.c
+++ b/drivers/media/pci/meye/meye.c
@@ -34,6 +34,8 @@
 #include "meye.h"
 #include <linux/meye.h>
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Stelian Pop <stelian@popies.net>");
 MODULE_DESCRIPTION("v4l2 driver for the MotionEye camera");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/pci/saa7134/saa7134-cards.c b/drivers/media/pci/saa7134/saa7134-cards.c
index ce449c941171..5a4d9a3c0c8f 100644
--- a/drivers/media/pci/saa7134/saa7134-cards.c
+++ b/drivers/media/pci/saa7134/saa7134-cards.c
@@ -23,6 +23,8 @@
 #include "xc5000.h"
 #include "s5h1411.h"
 
+#include <media/compat.h>
+
 /* Input names */
 const char * const saa7134_input_name[] = {
 	[SAA7134_INPUT_MUTE]       = "mute",
diff --git a/drivers/media/pci/saa7134/saa7134-video.c b/drivers/media/pci/saa7134/saa7134-video.c
index 9a6a6b68f8e3..2229d8b8be6b 100644
--- a/drivers/media/pci/saa7134/saa7134-video.c
+++ b/drivers/media/pci/saa7134/saa7134-video.c
@@ -21,6 +21,8 @@
 #include <media/v4l2-event.h>
 #include <media/i2c/saa6588.h>
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------ */
 
 unsigned int video_debug;
diff --git a/drivers/media/pci/saa7164/saa7164-dvb.c b/drivers/media/pci/saa7164/saa7164-dvb.c
index 24421c116b0b..1d29badfdde3 100644
--- a/drivers/media/pci/saa7164/saa7164-dvb.c
+++ b/drivers/media/pci/saa7164/saa7164-dvb.c
@@ -14,6 +14,8 @@
 #include "si2168.h"
 #include "lgdt3306a.h"
 
+#include <media/compat.h>
+
 #define DRIVER_NAME "saa7164"
 
 DVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);
diff --git a/drivers/media/pci/smipcie/smipcie-main.c b/drivers/media/pci/smipcie/smipcie-main.c
index 9ca0fc3e6f80..426adf939b76 100644
--- a/drivers/media/pci/smipcie/smipcie-main.c
+++ b/drivers/media/pci/smipcie/smipcie-main.c
@@ -12,6 +12,8 @@
 #include "si2168.h"
 #include "si2157.h"
 
+#include <media/compat.h>
+
 DVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);
 
 static int smi_hw_init(struct smi_dev *dev)
diff --git a/drivers/media/pci/solo6x10/solo6x10-core.c b/drivers/media/pci/solo6x10/solo6x10-core.c
index d497afc7e7b7..185065aaaffb 100644
--- a/drivers/media/pci/solo6x10/solo6x10-core.c
+++ b/drivers/media/pci/solo6x10/solo6x10-core.c
@@ -22,6 +22,8 @@
 #include "solo6x10.h"
 #include "solo6x10-tw28.h"
 
+#include <media/compat.h>
+
 MODULE_DESCRIPTION("Softlogic 6x10 MPEG4/H.264/G.723 CODEC V4L2/ALSA Driver");
 MODULE_AUTHOR("Bluecherry <maintainers@bluecherrydvr.com>");
 MODULE_VERSION(SOLO6X10_VERSION);
diff --git a/drivers/media/pci/solo6x10/solo6x10-i2c.c b/drivers/media/pci/solo6x10/solo6x10-i2c.c
index 7db785e9c997..04c4f0885557 100644
--- a/drivers/media/pci/solo6x10/solo6x10-i2c.c
+++ b/drivers/media/pci/solo6x10/solo6x10-i2c.c
@@ -22,6 +22,8 @@
 
 #include "solo6x10.h"
 
+#include <media/compat.h>
+
 u8 solo_i2c_readbyte(struct solo_dev *solo_dev, int id, u8 addr, u8 off)
 {
 	struct i2c_msg msgs[2];
diff --git a/drivers/media/pci/ttpci/av7110.c b/drivers/media/pci/ttpci/av7110.c
index 45228f4f6fc6..fabe9e76e97c 100644
--- a/drivers/media/pci/ttpci/av7110.c
+++ b/drivers/media/pci/ttpci/av7110.c
@@ -41,6 +41,8 @@
 
 #include <media/dvb_frontend.h>
 
+#include <media/compat.h>
+
 #include "ttpci-eeprom.h"
 #include "av7110.h"
 #include "av7110_hw.h"
diff --git a/drivers/media/pci/ttpci/av7110_hw.c b/drivers/media/pci/ttpci/av7110_hw.c
index 93ca31e38ddd..fc1fab2ac2d2 100644
--- a/drivers/media/pci/ttpci/av7110_hw.c
+++ b/drivers/media/pci/ttpci/av7110_hw.c
@@ -23,6 +23,8 @@
 #include "av7110.h"
 #include "av7110_hw.h"
 
+#include <media/compat.h>
+
 #define _NOHANDSHAKE
 
 /*
diff --git a/drivers/media/pci/ttpci/av7110_ipack.c b/drivers/media/pci/ttpci/av7110_ipack.c
index 30330ed01ce8..dbc5d770e796 100644
--- a/drivers/media/pci/ttpci/av7110_ipack.c
+++ b/drivers/media/pci/ttpci/av7110_ipack.c
@@ -4,6 +4,7 @@
 #include <linux/string.h>	/* for memcpy() */
 #include <linux/vmalloc.h>
 
+#include <media/compat.h>
 
 void av7110_ipack_reset(struct ipack *p)
 {
diff --git a/drivers/media/pci/ttpci/budget-av.c b/drivers/media/pci/ttpci/budget-av.c
index 64e61883a79d..b4d7c89c6ba7 100644
--- a/drivers/media/pci/ttpci/budget-av.c
+++ b/drivers/media/pci/ttpci/budget-av.c
@@ -40,6 +40,8 @@
 
 #include <media/dvb_ca_en50221.h>
 
+#include <media/compat.h>
+
 #define DEBICICAM		0x02420000
 
 #define SLOTSTATUS_NONE         1
diff --git a/drivers/media/pci/ttpci/budget.c b/drivers/media/pci/ttpci/budget.c
index a88711a3ac7f..090ef6963033 100644
--- a/drivers/media/pci/ttpci/budget.c
+++ b/drivers/media/pci/ttpci/budget.c
@@ -35,6 +35,7 @@
 #include "isl6423.h"
 #include "lnbh24.h"
 
+#include <media/compat.h>
 
 static int diseqc_method;
 module_param(diseqc_method, int, 0444);
diff --git a/drivers/media/platform/marvell-ccic/mcam-core.c b/drivers/media/platform/marvell-ccic/mcam-core.c
index cd297d14d2b1..cf9c920aee67 100644
--- a/drivers/media/platform/marvell-ccic/mcam-core.c
+++ b/drivers/media/platform/marvell-ccic/mcam-core.c
@@ -35,6 +35,8 @@
 
 #include "mcam-core.h"
 
+#include <media/compat.h>
+
 #ifdef MCAM_MODE_VMALLOC
 /*
  * Internal DMA buffer management.  Since the controller cannot do S/G I/O,
diff --git a/drivers/media/platform/via-camera.c b/drivers/media/platform/via-camera.c
index ed0ad68c5c48..0afed8815f4d 100644
--- a/drivers/media/platform/via-camera.c
+++ b/drivers/media/platform/via-camera.c
@@ -35,6 +35,8 @@
 #define machine_is_olpc(x) 0
 #endif
 
+#include <media/compat.h>
+
 #include "via-camera.h"
 
 MODULE_ALIAS("platform:viafb-camera");
diff --git a/drivers/media/radio/radio-si476x.c b/drivers/media/radio/radio-si476x.c
index 23997425bdb5..844fb393f14e 100644
--- a/drivers/media/radio/radio-si476x.c
+++ b/drivers/media/radio/radio-si476x.c
@@ -25,6 +25,8 @@
 #include <media/drv-intf/si476x.h>
 #include <linux/mfd/si476x-core.h>
 
+#include <media/compat.h>
+
 #define FM_FREQ_RANGE_LOW   64000000
 #define FM_FREQ_RANGE_HIGH 108000000
 
diff --git a/drivers/media/radio/si4713/si4713.c b/drivers/media/radio/si4713/si4713.c
index 6afa7c3464ab..18713ce433f4 100644
--- a/drivers/media/radio/si4713/si4713.c
+++ b/drivers/media/radio/si4713/si4713.c
@@ -22,6 +22,8 @@
 
 #include "si4713.h"
 
+#include <media/compat.h>
+
 /* module parameters */
 static int debug;
 module_param(debug, int, S_IRUGO | S_IWUSR);
diff --git a/drivers/media/radio/tea575x.c b/drivers/media/radio/tea575x.c
index c37315226c42..a35a11408e3e 100644
--- a/drivers/media/radio/tea575x.c
+++ b/drivers/media/radio/tea575x.c
@@ -18,6 +18,8 @@
 #include <media/v4l2-event.h>
 #include <media/drv-intf/tea575x.h>
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Jaroslav Kysela <perex@perex.cz>");
 MODULE_DESCRIPTION("Routines for control of TEA5757/5759 Philips AM/FM radio tuner chips");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/rc/iguanair.c b/drivers/media/rc/iguanair.c
index 84949baf9f6b..e1d4244d9892 100644
--- a/drivers/media/rc/iguanair.c
+++ b/drivers/media/rc/iguanair.c
@@ -14,6 +14,8 @@
 #include <linux/completion.h>
 #include <media/rc-core.h>
 
+#include <media/compat.h>
+
 #define BUF_SIZE 152
 
 struct iguanair {
diff --git a/drivers/media/rc/ir-rc6-decoder.c b/drivers/media/rc/ir-rc6-decoder.c
index 0657ad5eef48..60afef4439b5 100644
--- a/drivers/media/rc/ir-rc6-decoder.c
+++ b/drivers/media/rc/ir-rc6-decoder.c
@@ -7,6 +7,8 @@
 #include "rc-core-priv.h"
 #include <linux/module.h>
 
+#include <media/compat.h>
+
 /*
  * This decoder currently supports:
  * RC6-0-16	(standard toggle bit in header)
diff --git a/drivers/media/rc/ir-sony-decoder.c b/drivers/media/rc/ir-sony-decoder.c
index d760d52abaa2..bdde2cf2752c 100644
--- a/drivers/media/rc/ir-sony-decoder.c
+++ b/drivers/media/rc/ir-sony-decoder.c
@@ -8,6 +8,8 @@
 #include <linux/module.h>
 #include "rc-core-priv.h"
 
+#include <media/compat.h>
+
 #define SONY_UNIT		600 /* us */
 #define SONY_HEADER_PULSE	(4 * SONY_UNIT)
 #define	SONY_HEADER_SPACE	(1 * SONY_UNIT)
diff --git a/drivers/media/rc/lirc_dev.c b/drivers/media/rc/lirc_dev.c
index 1cab15f11b2e..100fc624319a 100644
--- a/drivers/media/rc/lirc_dev.c
+++ b/drivers/media/rc/lirc_dev.c
@@ -20,6 +20,8 @@
 #include "rc-core-priv.h"
 #include <uapi/linux/lirc.h>
 
+#include <media/compat.h>
+
 #define LIRCBUF_SIZE	1024
 
 static dev_t lirc_base_dev;
diff --git a/drivers/media/test-drivers/vicodec/vicodec-core.c b/drivers/media/test-drivers/vicodec/vicodec-core.c
index 0e115683f8da..87c8680d0b83 100644
--- a/drivers/media/test-drivers/vicodec/vicodec-core.c
+++ b/drivers/media/test-drivers/vicodec/vicodec-core.c
@@ -25,6 +25,8 @@
 
 #include "codec-v4l2-fwht.h"
 
+#include <media/compat.h>
+
 MODULE_DESCRIPTION("Virtual codec device");
 MODULE_AUTHOR("Hans Verkuil <hans.verkuil@cisco.com>");
 MODULE_LICENSE("GPL v2");
diff --git a/drivers/media/test-drivers/vimc/vimc-sensor.c b/drivers/media/test-drivers/vimc/vimc-sensor.c
index ba5db5a150b4..b48066c4ecb2 100644
--- a/drivers/media/test-drivers/vimc/vimc-sensor.c
+++ b/drivers/media/test-drivers/vimc/vimc-sensor.c
@@ -14,6 +14,8 @@
 
 #include "vimc-common.h"
 
+#include <media/compat.h>
+
 enum vimc_sen_osd_mode {
 	VIMC_SEN_OSD_SHOW_ALL = 0,
 	VIMC_SEN_OSD_SHOW_COUNTERS = 1,
diff --git a/drivers/media/test-drivers/vivid/vivid-vbi-gen.c b/drivers/media/test-drivers/vivid/vivid-vbi-gen.c
index a141369a7a63..75479cb83fa0 100644
--- a/drivers/media/test-drivers/vivid/vivid-vbi-gen.c
+++ b/drivers/media/test-drivers/vivid/vivid-vbi-gen.c
@@ -13,6 +13,8 @@
 
 #include "vivid-vbi-gen.h"
 
+#include <media/compat.h>
+
 static void wss_insert(u8 *wss, u32 val, unsigned size)
 {
 	while (size--)
diff --git a/drivers/media/tuners/fc0011.c b/drivers/media/tuners/fc0011.c
index eaa3bbc903d7..91133ecd30fe 100644
--- a/drivers/media/tuners/fc0011.c
+++ b/drivers/media/tuners/fc0011.c
@@ -10,6 +10,7 @@
 
 #include "fc0011.h"
 
+#include <media/compat.h>
 
 /* Tuner registers */
 enum {
diff --git a/drivers/media/tuners/tda18271-fe.c b/drivers/media/tuners/tda18271-fe.c
index f0371d004b36..be7279c42948 100644
--- a/drivers/media/tuners/tda18271-fe.c
+++ b/drivers/media/tuners/tda18271-fe.c
@@ -12,6 +12,8 @@
 #include <linux/delay.h>
 #include <linux/videodev2.h>
 
+#include <media/compat.h>
+
 int tda18271_debug;
 module_param_named(debug, tda18271_debug, int, 0644);
 MODULE_PARM_DESC(debug, "set debug level (info=1, map=2, reg=4, adv=8, cal=16 (or-able))");
diff --git a/drivers/media/tuners/xc5000.c b/drivers/media/tuners/xc5000.c
index 7b7d9fe4f945..85f215dd8000 100644
--- a/drivers/media/tuners/xc5000.c
+++ b/drivers/media/tuners/xc5000.c
@@ -20,6 +20,8 @@
 #include "xc5000.h"
 #include "tuner-i2c.h"
 
+#include <media/compat.h>
+
 static int debug;
 module_param(debug, int, 0644);
 MODULE_PARM_DESC(debug, "Turn on/off debugging (default:off).");
diff --git a/drivers/media/usb/cpia2/cpia2_core.c b/drivers/media/usb/cpia2/cpia2_core.c
index e747548ab286..73912e9c65e6 100644
--- a/drivers/media/usb/cpia2/cpia2_core.c
+++ b/drivers/media/usb/cpia2/cpia2_core.c
@@ -25,6 +25,8 @@
 #include <linux/firmware.h>
 #include <linux/sched/signal.h>
 
+#include <media/compat.h>
+
 #define FIRMWARE "cpia2/stv0672_vp4.bin"
 MODULE_FIRMWARE(FIRMWARE);
 
diff --git a/drivers/media/usb/cx231xx/cx231xx-video.c b/drivers/media/usb/cx231xx/cx231xx-video.c
index 425e470b0fd3..63d5fadc39ca 100644
--- a/drivers/media/usb/cx231xx/cx231xx-video.c
+++ b/drivers/media/usb/cx231xx/cx231xx-video.c
@@ -31,6 +31,8 @@
 
 #include "cx231xx-vbi.h"
 
+#include <media/compat.h>
+
 #define CX231XX_VERSION "0.0.3"
 
 #define DRIVER_AUTHOR   "Srinivasa Deevi <srinivasa.deevi@conexant.com>"
diff --git a/drivers/media/usb/dvb-usb-v2/af9015.c b/drivers/media/usb/dvb-usb-v2/af9015.c
index c70b3cef3176..f10cb47bab7e 100644
--- a/drivers/media/usb/dvb-usb-v2/af9015.c
+++ b/drivers/media/usb/dvb-usb-v2/af9015.c
@@ -9,6 +9,8 @@
 
 #include "af9015.h"
 
+#include <media/compat.h>
+
 static int dvb_usb_af9015_remote;
 module_param_named(remote, dvb_usb_af9015_remote, int, 0644);
 MODULE_PARM_DESC(remote, "select remote");
diff --git a/drivers/media/usb/dvb-usb-v2/af9035.c b/drivers/media/usb/dvb-usb-v2/af9035.c
index b1f69c11c839..741d8ff7f32f 100644
--- a/drivers/media/usb/dvb-usb-v2/af9035.c
+++ b/drivers/media/usb/dvb-usb-v2/af9035.c
@@ -6,6 +6,8 @@
  * Copyright (C) 2012 Antti Palosaari <crope@iki.fi>
  */
 
+#include <media/compat.h>
+
 #include "af9035.h"
 
 /* Max transfer size done by I2C transfer functions */
diff --git a/drivers/media/usb/dvb-usb-v2/anysee.c b/drivers/media/usb/dvb-usb-v2/anysee.c
index 89a1b204b90c..b8ab9e33c0ec 100644
--- a/drivers/media/usb/dvb-usb-v2/anysee.c
+++ b/drivers/media/usb/dvb-usb-v2/anysee.c
@@ -18,6 +18,8 @@
  * is highly welcome!
  */
 
+#include <media/compat.h>
+
 #include "anysee.h"
 #include "dvb-pll.h"
 #include "tda1002x.h"
diff --git a/drivers/media/usb/dvb-usb-v2/gl861.c b/drivers/media/usb/dvb-usb-v2/gl861.c
index 0c434259c36f..ad321f9c9557 100644
--- a/drivers/media/usb/dvb-usb-v2/gl861.c
+++ b/drivers/media/usb/dvb-usb-v2/gl861.c
@@ -12,6 +12,8 @@
 #include "tc90522.h"
 #include "dvb-pll.h"
 
+#include <media/compat.h>
+
 DVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);
 
 struct gl861 {
diff --git a/drivers/media/usb/dvb-usb-v2/lmedm04.c b/drivers/media/usb/dvb-usb-v2/lmedm04.c
index 5a7a9522d46d..717b89f5b78a 100644
--- a/drivers/media/usb/dvb-usb-v2/lmedm04.c
+++ b/drivers/media/usb/dvb-usb-v2/lmedm04.c
@@ -69,6 +69,7 @@
 #include "m88rs2000.h"
 #include "ts2020.h"
 
+#include <media/compat.h>
 
 #define LME2510_C_S7395	"dvb-usb-lme2510c-s7395.fw";
 #define LME2510_C_LG	"dvb-usb-lme2510c-lg.fw";
diff --git a/drivers/media/usb/dvb-usb-v2/mxl111sf-gpio.c b/drivers/media/usb/dvb-usb-v2/mxl111sf-gpio.c
index ef489c566b75..66c5cd9c3156 100644
--- a/drivers/media/usb/dvb-usb-v2/mxl111sf-gpio.c
+++ b/drivers/media/usb/dvb-usb-v2/mxl111sf-gpio.c
@@ -9,6 +9,8 @@
 #include "mxl111sf-i2c.h"
 #include "mxl111sf.h"
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------------- */
 
 #define MXL_GPIO_MUX_REG_0 0x84
diff --git a/drivers/media/usb/dvb-usb-v2/rtl28xxu.c b/drivers/media/usb/dvb-usb-v2/rtl28xxu.c
index 91460e4d0c30..7075b214c0f2 100644
--- a/drivers/media/usb/dvb-usb-v2/rtl28xxu.c
+++ b/drivers/media/usb/dvb-usb-v2/rtl28xxu.c
@@ -7,6 +7,8 @@
  * Copyright (C) 2012 Thomas Mair <thomas.mair86@googlemail.com>
  */
 
+#include <media/compat.h>
+
 #include "rtl28xxu.h"
 
 static int rtl28xxu_disable_rc;
diff --git a/drivers/media/usb/dvb-usb-v2/zd1301.c b/drivers/media/usb/dvb-usb-v2/zd1301.c
index ba2c1b0d3989..8fd7dd5636e6 100644
--- a/drivers/media/usb/dvb-usb-v2/zd1301.c
+++ b/drivers/media/usb/dvb-usb-v2/zd1301.c
@@ -5,6 +5,8 @@
  * Copyright (C) 2015 Antti Palosaari <crope@iki.fi>
  */
 
+#include <media/compat.h>
+
 #include "dvb_usb.h"
 #include "zd1301_demod.h"
 #include "mt2060.h"
diff --git a/drivers/media/usb/dvb-usb/dib0700_devices.c b/drivers/media/usb/dvb-usb/dib0700_devices.c
index d3288c107906..8328855a7f83 100644
--- a/drivers/media/usb/dvb-usb/dib0700_devices.c
+++ b/drivers/media/usb/dvb-usb/dib0700_devices.c
@@ -5,6 +5,8 @@
  */
 #include "dib0700.h"
 
+#include <media/compat.h>
+
 #include "dib3000mc.h"
 #include "dib7000m.h"
 #include "dib7000p.h"
diff --git a/drivers/media/usb/dvb-usb/dw2102.c b/drivers/media/usb/dvb-usb/dw2102.c
index a27a68440325..f5595bdd1622 100644
--- a/drivers/media/usb/dvb-usb/dw2102.c
+++ b/drivers/media/usb/dvb-usb/dw2102.c
@@ -11,6 +11,9 @@
  * see Documentation/driver-api/media/drivers/dvb-usb.rst for more information
  */
 #include <media/dvb-usb-ids.h>
+
+#include <media/compat.h>
+
 #include "dw2102.h"
 #include "si21xx.h"
 #include "stv0299.h"
diff --git a/drivers/media/usb/em28xx/Makefile b/drivers/media/usb/em28xx/Makefile
index 8c2fc3104561..07730d199dd9 100644
--- a/drivers/media/usb/em28xx/Makefile
+++ b/drivers/media/usb/em28xx/Makefile
@@ -11,5 +11,5 @@ obj-$(CONFIG_VIDEO_EM28XX_ALSA) += em28xx-alsa.o
 obj-$(CONFIG_VIDEO_EM28XX_DVB) += em28xx-dvb.o
 obj-$(CONFIG_VIDEO_EM28XX_RC) += em28xx-rc.o
 
-ccflags-y += -I $(srctree)/drivers/media/tuners
-ccflags-y += -I $(srctree)/drivers/media/dvb-frontends
+ccflags-y += -I$(srctree)/drivers/media/tuners
+ccflags-y += -I$(srctree)/drivers/media/dvb-frontends
diff --git a/drivers/media/usb/em28xx/em28xx-dvb.c b/drivers/media/usb/em28xx/em28xx-dvb.c
index b9c1a9e724b7..a57a7cae1c26 100644
--- a/drivers/media/usb/em28xx/em28xx-dvb.c
+++ b/drivers/media/usb/em28xx/em28xx-dvb.c
@@ -44,7 +44,7 @@
 #include "mt352.h"
 #include "mt352_priv.h" /* FIXME */
 #include "tda1002x.h"
-#include "drx39xxj.h"
+#include "../../dvb-frontends/drx39xyj/drx39xxj.h"
 #include "tda18271.h"
 #include "s921.h"
 #include "drxd.h"
diff --git a/drivers/media/usb/go7007/go7007-driver.c b/drivers/media/usb/go7007/go7007-driver.c
index f1767be9d868..a18511e58fd8 100644
--- a/drivers/media/usb/go7007/go7007-driver.c
+++ b/drivers/media/usb/go7007/go7007-driver.c
@@ -24,6 +24,8 @@
 
 #include "go7007-priv.h"
 
+#include <media/compat.h>
+
 /*
  * Wait for an interrupt to be delivered from the GO7007SB and return
  * the associated value and data.
diff --git a/drivers/media/usb/gspca/mr97310a.c b/drivers/media/usb/gspca/mr97310a.c
index a508d4f66f1a..d6f6a0f041ba 100644
--- a/drivers/media/usb/gspca/mr97310a.c
+++ b/drivers/media/usb/gspca/mr97310a.c
@@ -34,6 +34,8 @@
 
 #include "gspca.h"
 
+#include <media/compat.h>
+
 #define CAM_TYPE_CIF			0
 #define CAM_TYPE_VGA			1
 
diff --git a/drivers/media/usb/gspca/nw80x.c b/drivers/media/usb/gspca/nw80x.c
index d97b6735bc83..9fbac4d3ca4c 100644
--- a/drivers/media/usb/gspca/nw80x.c
+++ b/drivers/media/usb/gspca/nw80x.c
@@ -14,6 +14,8 @@
 
 #include "gspca.h"
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Jean-Francois Moine <http://moinejf.free.fr>");
 MODULE_DESCRIPTION("NW80x USB Camera Driver");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/usb/gspca/ov519.c b/drivers/media/usb/gspca/ov519.c
index a55b4e88a107..ad6b425d57ad 100644
--- a/drivers/media/usb/gspca/ov519.c
+++ b/drivers/media/usb/gspca/ov519.c
@@ -31,6 +31,8 @@
 #include <linux/input.h>
 #include "gspca.h"
 
+#include <media/compat.h>
+
 /* The jpeg_hdr is used by w996Xcf only */
 /* The CONEX_CAM define for jpeg.h needs renaming, now its used here too */
 #define CONEX_CAM
diff --git a/drivers/media/usb/gspca/sn9c20x.c b/drivers/media/usb/gspca/sn9c20x.c
index 2152e9674969..345c8ba89dc6 100644
--- a/drivers/media/usb/gspca/sn9c20x.c
+++ b/drivers/media/usb/gspca/sn9c20x.c
@@ -17,6 +17,8 @@
 
 #include <linux/dmi.h>
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Brian Johnson <brijohn@gmail.com>, microdia project <microdia@googlegroups.com>");
 MODULE_DESCRIPTION("GSPCA/SN9C20X USB Camera Driver");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/usb/gspca/sunplus.c b/drivers/media/usb/gspca/sunplus.c
index 5814c322de88..b3639fec0cbe 100644
--- a/drivers/media/usb/gspca/sunplus.c
+++ b/drivers/media/usb/gspca/sunplus.c
@@ -14,6 +14,8 @@
 #include "gspca.h"
 #include "jpeg.h"
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Michel Xhaard <mxhaard@users.sourceforge.net>");
 MODULE_DESCRIPTION("GSPCA/SPCA5xx USB Camera Driver");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/usb/gspca/xirlink_cit.c b/drivers/media/usb/gspca/xirlink_cit.c
index 62ae941dcaf5..0a0baa89a5c2 100644
--- a/drivers/media/usb/gspca/xirlink_cit.c
+++ b/drivers/media/usb/gspca/xirlink_cit.c
@@ -13,6 +13,8 @@
  * (C) Copyright 1999 Randy Dunlap
  */
 
+#include <media/compat.h>
+
 #undef pr_fmt
 #define pr_fmt(fmt) KBUILD_MODNAME ": " fmt
 
diff --git a/drivers/media/usb/gspca/zc3xx.c b/drivers/media/usb/gspca/zc3xx.c
index 5ecc127b9309..7823c885ff23 100644
--- a/drivers/media/usb/gspca/zc3xx.c
+++ b/drivers/media/usb/gspca/zc3xx.c
@@ -13,6 +13,8 @@
 #include "gspca.h"
 #include "jpeg.h"
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Jean-Francois Moine <http://moinejf.free.fr>, Serge A. Suchkov <Serge.A.S@tochka.ru>");
 MODULE_DESCRIPTION("GSPCA ZC03xx/VC3xx USB Camera Driver");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/usb/pwc/pwc-v4l.c b/drivers/media/usb/pwc/pwc-v4l.c
index 71b719d363a5..af3a5faa69f2 100644
--- a/drivers/media/usb/pwc/pwc-v4l.c
+++ b/drivers/media/usb/pwc/pwc-v4l.c
@@ -25,6 +25,8 @@
 
 #include "pwc.h"
 
+#include <media/compat.h>
+
 #define PWC_CID_CUSTOM(ctrl) ((V4L2_CID_USER_BASE | 0xf000) + custom_ ## ctrl)
 
 static int pwc_g_volatile_ctrl(struct v4l2_ctrl *ctrl);
diff --git a/drivers/media/usb/siano/smsusb.c b/drivers/media/usb/siano/smsusb.c
index df4c5dcba39c..92b89713102b 100644
--- a/drivers/media/usb/siano/smsusb.c
+++ b/drivers/media/usb/siano/smsusb.c
@@ -21,6 +21,8 @@ Copyright (C) 2005-2009, Uri Shkolnik, Anatoly Greenblat
 #include "sms-cards.h"
 #include "smsendian.h"
 
+#include <media/compat.h>
+
 #define USB1_BUFFER_SIZE		0x1000
 #define USB2_BUFFER_SIZE		0x2000
 
diff --git a/drivers/media/usb/uvc/uvc_video.c b/drivers/media/usb/uvc/uvc_video.c
index a6a441d92b94..eb5eacbe95d4 100644
--- a/drivers/media/usb/uvc/uvc_video.c
+++ b/drivers/media/usb/uvc/uvc_video.c
@@ -21,6 +21,8 @@
 
 #include "uvcvideo.h"
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------------
  * UVC Controls
  */
diff --git a/drivers/media/v4l2-core/v4l2-async.c b/drivers/media/v4l2-core/v4l2-async.c
index e3ab003a6c85..079ddd5204b6 100644
--- a/drivers/media/v4l2-core/v4l2-async.c
+++ b/drivers/media/v4l2-core/v4l2-async.c
@@ -22,6 +22,8 @@
 #include <media/v4l2-fwnode.h>
 #include <media/v4l2-subdev.h>
 
+#include <media/compat.h>
+
 static int v4l2_async_notifier_call_bound(struct v4l2_async_notifier *n,
 					  struct v4l2_subdev *subdev,
 					  struct v4l2_async_subdev *asd)
diff --git a/drivers/media/v4l2-core/v4l2-ctrls.c b/drivers/media/v4l2-core/v4l2-ctrls.c
index a2be264ca439..c69df97942d6 100644
--- a/drivers/media/v4l2-core/v4l2-ctrls.c
+++ b/drivers/media/v4l2-core/v4l2-ctrls.c
@@ -20,6 +20,8 @@
 #include <media/v4l2-fwnode.h>
 #include <media/v4l2-ioctl.h>
 
+#include <media/compat.h>
+
 #define dprintk(vdev, fmt, arg...) do {					\
 	if (!WARN_ON(!(vdev)) && ((vdev)->dev_debug & V4L2_DEV_DEBUG_CTRL)) \
 		printk(KERN_DEBUG pr_fmt("%s: %s: " fmt),		\
diff --git a/drivers/media/v4l2-core/v4l2-fwnode.c b/drivers/media/v4l2-core/v4l2-fwnode.c
index d7bbe33840cb..af9d0374dacb 100644
--- a/drivers/media/v4l2-core/v4l2-fwnode.c
+++ b/drivers/media/v4l2-core/v4l2-fwnode.c
@@ -28,6 +28,8 @@
 #include <media/v4l2-fwnode.h>
 #include <media/v4l2-subdev.h>
 
+#include <media/compat.h>
+
 enum v4l2_fwnode_bus_type {
 	V4L2_FWNODE_BUS_TYPE_GUESS = 0,
 	V4L2_FWNODE_BUS_TYPE_CSI2_CPHY,
diff --git a/drivers/media/v4l2-core/v4l2-i2c.c b/drivers/media/v4l2-core/v4l2-i2c.c
index b4acca75644b..2313a9ec967d 100644
--- a/drivers/media/v4l2-core/v4l2-i2c.c
+++ b/drivers/media/v4l2-core/v4l2-i2c.c
@@ -8,6 +8,8 @@
 #include <media/v4l2-common.h>
 #include <media/v4l2-device.h>
 
+#include <media/compat.h>
+
 void v4l2_i2c_subdev_unregister(struct v4l2_subdev *sd)
 {
 	struct i2c_client *client = v4l2_get_subdevdata(sd);
diff --git a/drivers/media/v4l2-core/v4l2-ioctl.c b/drivers/media/v4l2-core/v4l2-ioctl.c
index ceb04bd0e799..88b296264d93 100644
--- a/drivers/media/v4l2-core/v4l2-ioctl.c
+++ b/drivers/media/v4l2-core/v4l2-ioctl.c
@@ -29,6 +29,8 @@
 
 #include <trace/events/v4l2.h>
 
+#include <media/compat.h>
+
 /* Zero out the end of the struct pointed to by p.  Everything after, but
  * not including, the specified field is cleared. */
 #define CLEAR_AFTER_FIELD(p, field) \
diff --git a/drivers/media/v4l2-core/videobuf-core.c b/drivers/media/v4l2-core/videobuf-core.c
index 8a64019170ea..8a39103eb2e2 100644
--- a/drivers/media/v4l2-core/videobuf-core.c
+++ b/drivers/media/v4l2-core/videobuf-core.c
@@ -21,6 +21,8 @@
 #include <media/videobuf-core.h>
 #include <media/v4l2-common.h>
 
+#include <media/compat.h>
+
 #define MAGIC_BUFFER 0x20070728
 #define MAGIC_CHECK(is, should)						\
 	do {								\
diff --git a/include/media/v4l2-dev.h b/include/media/v4l2-dev.h
index ad2d41952442..f35b6e74b206 100644
--- a/include/media/v4l2-dev.h
+++ b/include/media/v4l2-dev.h
@@ -39,7 +39,8 @@ enum vfl_devnode_type {
 	VFL_TYPE_SUBDEV,
 	VFL_TYPE_SDR,
 	VFL_TYPE_TOUCH,
-	VFL_TYPE_MAX /* Shall be the last one */
+	VFL_TYPE_MAX, /* Shall be the last one */
+	VFL_TYPE_GRABBER = VFL_TYPE_VIDEO,
 };
 
 /**
-- 
2.17.1

