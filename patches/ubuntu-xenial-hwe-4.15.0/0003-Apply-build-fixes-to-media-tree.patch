From 9f9c629ddffc335629d9d8c65f05dddf0d3b91bf Mon Sep 17 00:00:00 2001
From: Brad Love <hidden@email.co>
Date: Tue, 8 Oct 2019 15:13:41 -0500
Subject: [PATCH 3/6] Apply build fixes to media tree

---
 drivers/media/cec/cec-api.c                           | 2 ++
 drivers/media/common/saa7146/saa7146_fops.c           | 2 ++
 drivers/media/common/saa7146/saa7146_vbi.c            | 3 +++
 drivers/media/common/saa7146/saa7146_video.c          | 2 ++
 drivers/media/common/v4l2-tpg/v4l2-tpg-core.c         | 2 ++
 drivers/media/common/videobuf2/videobuf2-dma-contig.c | 1 +
 drivers/media/common/videobuf2/videobuf2-dma-sg.c     | 1 +
 drivers/media/common/videobuf2/videobuf2-vmalloc.c    | 1 +
 drivers/media/dvb-core/dmxdev.c                       | 2 ++
 drivers/media/dvb-core/dvb_demux.c                    | 2 ++
 drivers/media/dvb-core/dvb_net.c                      | 2 ++
 drivers/media/i2c/adv7604.c                           | 2 +-
 drivers/media/i2c/adv7842.c                           | 2 +-
 drivers/media/i2c/tc358743.c                          | 2 +-
 drivers/media/i2c/tda1997x.c                          | 4 ++--
 drivers/media/i2c/tvaudio.c                           | 2 ++
 drivers/media/media-device.c                          | 2 ++
 drivers/media/pci/bt8xx/bttv-driver.c                 | 2 ++
 drivers/media/pci/bt8xx/bttv-input.c                  | 1 +
 drivers/media/pci/cx18/cx18-fileops.c                 | 2 ++
 drivers/media/pci/cx18/cx18-streams.c                 | 2 ++
 drivers/media/pci/ddbridge/ddbridge-core.c            | 2 ++
 drivers/media/pci/ivtv/ivtv-driver.c                  | 2 ++
 drivers/media/pci/ivtv/ivtv-irq.c                     | 2 ++
 drivers/media/pci/netup_unidvb/netup_unidvb_core.c    | 2 ++
 drivers/media/pci/saa7134/saa7134-core.c              | 2 ++
 drivers/media/pci/saa7134/saa7134-input.c             | 2 ++
 drivers/media/pci/saa7134/saa7134-ts.c                | 2 ++
 drivers/media/pci/saa7134/saa7134-vbi.c               | 2 ++
 drivers/media/pci/saa7134/saa7134-video.c             | 2 ++
 drivers/media/pci/ttpci/av7110_ir.c                   | 2 ++
 drivers/media/pci/tw686x/tw686x-core.c                | 2 ++
 drivers/media/platform/vim2m.c                        | 2 ++
 drivers/media/radio/radio-cadet.c                     | 2 ++
 drivers/media/radio/wl128x/fmdrv_common.c             | 5 ++++-
 drivers/media/rc/ene_ir.c                             | 2 ++
 drivers/media/rc/igorplugusb.c                        | 2 ++
 drivers/media/rc/imon.c                               | 2 ++
 drivers/media/rc/ir-mce_kbd-decoder.c                 | 2 ++
 drivers/media/rc/lirc_dev.c                           | 2 ++
 drivers/media/rc/rc-ir-raw.c                          | 2 ++
 drivers/media/rc/rc-main.c                            | 2 ++
 drivers/media/rc/serial_ir.c                          | 2 ++
 drivers/media/rc/sir_ir.c                             | 2 ++
 drivers/media/usb/au0828/au0828-dvb.c                 | 2 ++
 drivers/media/usb/au0828/au0828-video.c               | 2 ++
 drivers/media/usb/em28xx/em28xx-dvb.c                 | 2 +-
 drivers/media/usb/pvrusb2/pvrusb2-hdw.c               | 6 ++++++
 drivers/media/usb/s2255/s2255drv.c                    | 2 ++
 drivers/media/usb/uvc/uvc_driver.c                    | 2 ++
 drivers/media/v4l2-core/v4l2-fwnode.c                 | 2 ++
 drivers/media/v4l2-core/v4l2-ioctl.c                  | 2 ++
 drivers/media/v4l2-core/videobuf-dma-sg.c             | 2 ++
 include/media/i2c/saa6588.h                           | 2 ++
 include/media/media-devnode.h                         | 2 ++
 include/media/v4l2-ctrls.h                            | 2 ++
 include/media/v4l2-dev.h                              | 2 ++
 include/media/videobuf-core.h                         | 2 ++
 58 files changed, 115 insertions(+), 7 deletions(-)

diff --git a/drivers/media/cec/cec-api.c b/drivers/media/cec/cec-api.c
index 3cc4490..3054eab 100644
--- a/drivers/media/cec/cec-api.c
+++ b/drivers/media/cec/cec-api.c
@@ -18,6 +18,8 @@
 #include <linux/uaccess.h>
 #include <linux/version.h>
 
+#include <media/compat.h>
+
 #include <media/cec-pin.h>
 #include "cec-priv.h"
 #include "cec-pin-priv.h"
diff --git a/drivers/media/common/saa7146/saa7146_fops.c b/drivers/media/common/saa7146/saa7146_fops.c
index 65b0c5a..d546665 100644
--- a/drivers/media/common/saa7146/saa7146_fops.c
+++ b/drivers/media/common/saa7146/saa7146_fops.c
@@ -5,6 +5,8 @@
 #include <media/drv-intf/saa7146_vv.h>
 #include <linux/module.h>
 
+#include <media/compat.h>
+
 /****************************************************************************/
 /* resource management functions, shamelessly stolen from saa7134 driver */
 
diff --git a/drivers/media/common/saa7146/saa7146_vbi.c b/drivers/media/common/saa7146/saa7146_vbi.c
index e1d369b..c2a675b 100644
--- a/drivers/media/common/saa7146/saa7146_vbi.c
+++ b/drivers/media/common/saa7146/saa7146_vbi.c
@@ -1,4 +1,7 @@
 // SPDX-License-Identifier: GPL-2.0
+
+#include <media/compat.h>
+
 #include <media/drv-intf/saa7146_vv.h>
 
 static int vbi_pixel_to_capture = 720 * 2;
diff --git a/drivers/media/common/saa7146/saa7146_video.c b/drivers/media/common/saa7146/saa7146_video.c
index 17998ed..62c5686 100644
--- a/drivers/media/common/saa7146/saa7146_video.c
+++ b/drivers/media/common/saa7146/saa7146_video.c
@@ -7,6 +7,8 @@
 #include <linux/module.h>
 #include <linux/kernel.h>
 
+#include <media/compat.h>
+
 static int max_memory = 32;
 
 module_param(max_memory, int, 0644);
diff --git a/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c b/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
index 07e0629..efec09e 100644
--- a/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
+++ b/drivers/media/common/v4l2-tpg/v4l2-tpg-core.c
@@ -11,6 +11,8 @@
 #include <linux/module.h>
 #include <media/tpg/v4l2-tpg.h>
 
+#include <media/compat.h>
+
 /* Must remain in sync with enum tpg_pattern */
 const char * const tpg_pattern_strings[] = {
 	"75% Colorbar",
diff --git a/drivers/media/common/videobuf2/videobuf2-dma-contig.c b/drivers/media/common/videobuf2/videobuf2-dma-contig.c
index 41bc166..71f0c07 100644
--- a/drivers/media/common/videobuf2/videobuf2-dma-contig.c
+++ b/drivers/media/common/videobuf2/videobuf2-dma-contig.c
@@ -223,6 +223,7 @@ struct vb2_dc_attachment {
 };
 
 static int vb2_dc_dmabuf_ops_attach(struct dma_buf *dbuf,
+	struct device *dev,
 	struct dma_buf_attachment *dbuf_attach)
 {
 	struct vb2_dc_attachment *attach;
diff --git a/drivers/media/common/videobuf2/videobuf2-dma-sg.c b/drivers/media/common/videobuf2/videobuf2-dma-sg.c
index 251c4b6..bcd44a5 100644
--- a/drivers/media/common/videobuf2/videobuf2-dma-sg.c
+++ b/drivers/media/common/videobuf2/videobuf2-dma-sg.c
@@ -371,6 +371,7 @@ struct vb2_dma_sg_attachment {
 };
 
 static int vb2_dma_sg_dmabuf_ops_attach(struct dma_buf *dbuf,
+	struct device *dev,
 	struct dma_buf_attachment *dbuf_attach)
 {
 	struct vb2_dma_sg_attachment *attach;
diff --git a/drivers/media/common/videobuf2/videobuf2-vmalloc.c b/drivers/media/common/videobuf2/videobuf2-vmalloc.c
index 9c0bf5c..92dc993 100644
--- a/drivers/media/common/videobuf2/videobuf2-vmalloc.c
+++ b/drivers/media/common/videobuf2/videobuf2-vmalloc.c
@@ -209,6 +209,7 @@ struct vb2_vmalloc_attachment {
 };
 
 static int vb2_vmalloc_dmabuf_ops_attach(struct dma_buf *dbuf,
+	struct device *dev,
 	struct dma_buf_attachment *dbuf_attach)
 {
 	struct vb2_vmalloc_attachment *attach;
diff --git a/drivers/media/dvb-core/dmxdev.c b/drivers/media/dvb-core/dmxdev.c
index 72d00e5..52be208 100644
--- a/drivers/media/dvb-core/dmxdev.c
+++ b/drivers/media/dvb-core/dmxdev.c
@@ -31,6 +31,8 @@
 #include <media/dmxdev.h>
 #include <media/dvb_vb2.h>
 
+#include <media/compat.h>
+
 static int debug;
 
 module_param(debug, int, 0644);
diff --git a/drivers/media/dvb-core/dvb_demux.c b/drivers/media/dvb-core/dvb_demux.c
index 6c7b568..c46d3da 100644
--- a/drivers/media/dvb-core/dvb_demux.c
+++ b/drivers/media/dvb-core/dvb_demux.c
@@ -33,6 +33,8 @@
 
 #include <media/dvb_demux.h>
 
+#include <media/compat.h>
+
 static int dvb_demux_tscheck;
 module_param(dvb_demux_tscheck, int, 0644);
 MODULE_PARM_DESC(dvb_demux_tscheck,
diff --git a/drivers/media/dvb-core/dvb_net.c b/drivers/media/dvb-core/dvb_net.c
index d6d21a8..9fc48c2 100644
--- a/drivers/media/dvb-core/dvb_net.c
+++ b/drivers/media/dvb-core/dvb_net.c
@@ -57,6 +57,8 @@
 #include <media/dvb_demux.h>
 #include <media/dvb_net.h>
 
+#include <media/compat.h>
+
 static inline __u32 iov_crc32( __u32 c, struct kvec *iov, unsigned int cnt )
 {
 	unsigned int j;
diff --git a/drivers/media/i2c/adv7604.c b/drivers/media/i2c/adv7604.c
index 28a84bf..dfb4400 100644
--- a/drivers/media/i2c/adv7604.c
+++ b/drivers/media/i2c/adv7604.c
@@ -2444,7 +2444,7 @@ static int adv76xx_read_infoframe(struct v4l2_subdev *sd, int index,
 		buffer[i + 3] = infoframe_read(sd,
 				       adv76xx_cri[index].payload_addr + i);
 
-	if (hdmi_infoframe_unpack(frame, buffer, sizeof(buffer)) < 0) {
+	if (hdmi_infoframe_unpack(frame, buffer) < 0) {
 		v4l2_err(sd, "%s: unpack of %s infoframe failed\n", __func__,
 			 adv76xx_cri[index].desc);
 		return -ENOENT;
diff --git a/drivers/media/i2c/adv7842.c b/drivers/media/i2c/adv7842.c
index 11ab2df..6eb2e81 100644
--- a/drivers/media/i2c/adv7842.c
+++ b/drivers/media/i2c/adv7842.c
@@ -2574,7 +2574,7 @@ static void log_infoframe(struct v4l2_subdev *sd, struct adv7842_cfg_read_infofr
 	for (i = 0; i < len; i++)
 		buffer[i + 3] = infoframe_read(sd, cri->payload_addr + i);
 
-	if (hdmi_infoframe_unpack(&frame, buffer, sizeof(buffer)) < 0) {
+	if (hdmi_infoframe_unpack(&frame, buffer) < 0) {
 		v4l2_err(sd, "%s: unpack of %s infoframe failed\n", __func__, cri->desc);
 		return;
 	}
diff --git a/drivers/media/i2c/tc358743.c b/drivers/media/i2c/tc358743.c
index bc2e35e..00dc930 100644
--- a/drivers/media/i2c/tc358743.c
+++ b/drivers/media/i2c/tc358743.c
@@ -444,7 +444,7 @@ static void print_avi_infoframe(struct v4l2_subdev *sd)
 
 	i2c_rd(sd, PK_AVI_0HEAD, buffer, HDMI_INFOFRAME_SIZE(AVI));
 
-	if (hdmi_infoframe_unpack(&frame, buffer, sizeof(buffer)) < 0) {
+	if (hdmi_infoframe_unpack(&frame, buffer) < 0) {
 		v4l2_err(sd, "%s: unpack of AVI infoframe failed\n", __func__);
 		return;
 	}
diff --git a/drivers/media/i2c/tda1997x.c b/drivers/media/i2c/tda1997x.c
index 0a2203b..fcef961 100644
--- a/drivers/media/i2c/tda1997x.c
+++ b/drivers/media/i2c/tda1997x.c
@@ -1253,7 +1253,7 @@ tda1997x_parse_infoframe(struct tda1997x_state *state, u16 addr)
 
 	/* read data */
 	len = io_readn(sd, addr, sizeof(buffer), buffer);
-	err = hdmi_infoframe_unpack(&frame, buffer, sizeof(buffer));
+	err = hdmi_infoframe_unpack(&frame, buffer);
 	if (err) {
 		v4l_err(state->client,
 			"failed parsing %d byte infoframe: 0x%04x/0x%02x\n",
@@ -1932,7 +1932,7 @@ static int tda1997x_log_infoframe(struct v4l2_subdev *sd, int addr)
 	/* read data */
 	len = io_readn(sd, addr, sizeof(buffer), buffer);
 	v4l2_dbg(1, debug, sd, "infoframe: addr=%d len=%d\n", addr, len);
-	err = hdmi_infoframe_unpack(&frame, buffer, sizeof(buffer));
+	err = hdmi_infoframe_unpack(&frame, buffer);
 	if (err) {
 		v4l_err(state->client,
 			"failed parsing %d byte infoframe: 0x%04x/0x%02x\n",
diff --git a/drivers/media/i2c/tvaudio.c b/drivers/media/i2c/tvaudio.c
index e6796e9..fbc3be28 100644
--- a/drivers/media/i2c/tvaudio.c
+++ b/drivers/media/i2c/tvaudio.c
@@ -40,6 +40,8 @@
 #include <media/v4l2-device.h>
 #include <media/v4l2-ctrls.h>
 
+#include <media/compat.h>
+
 /* ---------------------------------------------------------------------- */
 /* insmod args                                                            */
 
diff --git a/drivers/media/media-device.c b/drivers/media/media-device.c
index 4eb51a6..fc6ee86 100644
--- a/drivers/media/media-device.c
+++ b/drivers/media/media-device.c
@@ -33,6 +33,8 @@
 #include <media/media-devnode.h>
 #include <media/media-entity.h>
 
+#include <media/compat.h>
+
 #ifdef CONFIG_MEDIA_CONTROLLER
 
 /* -----------------------------------------------------------------------------
diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.c
index 82b152e..a1c8344 100644
--- a/drivers/media/pci/bt8xx/bttv-driver.c
+++ b/drivers/media/pci/bt8xx/bttv-driver.c
@@ -49,6 +49,8 @@
 
 #include <media/i2c/saa6588.h>
 
+#include <media/compat.h>
+
 #define BTTV_VERSION "0.9.19"
 
 unsigned int bttv_num;			/* number of Bt848s in use */
diff --git a/drivers/media/pci/bt8xx/bttv-input.c b/drivers/media/pci/bt8xx/bttv-input.c
index 79bc9f0..eb724df 100644
--- a/drivers/media/pci/bt8xx/bttv-input.c
+++ b/drivers/media/pci/bt8xx/bttv-input.c
@@ -18,6 +18,7 @@
 #include "bttv.h"
 #include "bttvp.h"
 
+#include <media/compat.h>
 
 static int ir_debug;
 module_param(ir_debug, int, 0644);
diff --git a/drivers/media/pci/cx18/cx18-fileops.c b/drivers/media/pci/cx18/cx18-fileops.c
index 4cf5b9c..207b43a 100644
--- a/drivers/media/pci/cx18/cx18-fileops.c
+++ b/drivers/media/pci/cx18/cx18-fileops.c
@@ -22,6 +22,8 @@
 #include "cx18-cards.h"
 #include <media/v4l2-event.h>
 
+#include <media/compat.h>
+
 /* This function tries to claim the stream for a specific file descriptor.
    If no one else is using this stream then the stream is claimed and
    associated VBI and IDX streams are also automatically claimed.
diff --git a/drivers/media/pci/cx18/cx18-streams.c b/drivers/media/pci/cx18/cx18-streams.c
index 9805e50..98ea0f1 100644
--- a/drivers/media/pci/cx18/cx18-streams.c
+++ b/drivers/media/pci/cx18/cx18-streams.c
@@ -20,6 +20,8 @@
 #include "cx18-scb.h"
 #include "cx18-dvb.h"
 
+#include <media/compat.h>
+
 #define CX18_DSP0_INTERRUPT_MASK	0xd0004C
 
 static const struct v4l2_file_operations cx18_v4l2_enc_fops = {
diff --git a/drivers/media/pci/ddbridge/ddbridge-core.c b/drivers/media/pci/ddbridge/ddbridge-core.c
index 7a2d196..c5b697f 100644
--- a/drivers/media/pci/ddbridge/ddbridge-core.c
+++ b/drivers/media/pci/ddbridge/ddbridge-core.c
@@ -30,6 +30,8 @@
 #include <linux/swab.h>
 #include <linux/vmalloc.h>
 
+#include <media/compat.h>
+
 #include "ddbridge.h"
 #include "ddbridge-i2c.h"
 #include "ddbridge-regs.h"
diff --git a/drivers/media/pci/ivtv/ivtv-driver.c b/drivers/media/pci/ivtv/ivtv-driver.c
index dd72709..8db79cd 100644
--- a/drivers/media/pci/ivtv/ivtv-driver.c
+++ b/drivers/media/pci/ivtv/ivtv-driver.c
@@ -61,6 +61,8 @@
 #include "tuner-xc2028.h"
 #include <uapi/linux/sched/types.h>
 
+#include <media/compat.h>
+
 /* If you have already X v4l cards, then set this to X. This way
    the device numbers stay matched. Example: you have a WinTV card
    without radio and a PVR-350 with. Normally this would give a
diff --git a/drivers/media/pci/ivtv/ivtv-irq.c b/drivers/media/pci/ivtv/ivtv-irq.c
index b7aaa8b..8363f19 100644
--- a/drivers/media/pci/ivtv/ivtv-irq.c
+++ b/drivers/media/pci/ivtv/ivtv-irq.c
@@ -15,6 +15,8 @@
 #include "ivtv-yuv.h"
 #include <media/v4l2-event.h>
 
+#include <media/compat.h>
+
 #define DMA_MAGIC_COOKIE 0x000001fe
 
 static void ivtv_dma_dec_start(struct ivtv_stream *s);
diff --git a/drivers/media/pci/netup_unidvb/netup_unidvb_core.c b/drivers/media/pci/netup_unidvb/netup_unidvb_core.c
index 80a7c41..690388e 100644
--- a/drivers/media/pci/netup_unidvb/netup_unidvb_core.c
+++ b/drivers/media/pci/netup_unidvb/netup_unidvb_core.c
@@ -28,6 +28,8 @@
 #include "helene.h"
 #include "lnbh25.h"
 
+#include <media/compat.h>
+
 static int spi_enable;
 module_param(spi_enable, int, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
 
diff --git a/drivers/media/pci/saa7134/saa7134-core.c b/drivers/media/pci/saa7134/saa7134-core.c
index fa9a0ea..408b86e 100644
--- a/drivers/media/pci/saa7134/saa7134-core.c
+++ b/drivers/media/pci/saa7134/saa7134-core.c
@@ -23,6 +23,8 @@
 #include <linux/dma-mapping.h>
 #include <linux/pm.h>
 
+#include <media/compat.h>
+
 MODULE_DESCRIPTION("v4l2 driver module for saa7130/34 based TV cards");
 MODULE_AUTHOR("Gerd Knorr <kraxel@bytesex.org> [SuSE Labs]");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/pci/saa7134/saa7134-input.c b/drivers/media/pci/saa7134/saa7134-input.c
index 9aea7c3..1c88d6f 100644
--- a/drivers/media/pci/saa7134/saa7134-input.c
+++ b/drivers/media/pci/saa7134/saa7134-input.c
@@ -13,6 +13,8 @@
 #include <linux/interrupt.h>
 #include <linux/slab.h>
 
+#include <media/compat.h>
+
 #define MODULE_NAME "saa7134"
 
 static unsigned int disable_ir;
diff --git a/drivers/media/pci/saa7134/saa7134-ts.c b/drivers/media/pci/saa7134/saa7134-ts.c
index 6a50531..24bb6de 100644
--- a/drivers/media/pci/saa7134/saa7134-ts.c
+++ b/drivers/media/pci/saa7134/saa7134-ts.c
@@ -16,6 +16,8 @@
 #include <linux/kernel.h>
 #include <linux/delay.h>
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------ */
 
 static unsigned int ts_debug;
diff --git a/drivers/media/pci/saa7134/saa7134-vbi.c b/drivers/media/pci/saa7134/saa7134-vbi.c
index 3f0b093..a1f3cd4 100644
--- a/drivers/media/pci/saa7134/saa7134-vbi.c
+++ b/drivers/media/pci/saa7134/saa7134-vbi.c
@@ -15,6 +15,8 @@
 #include <linux/module.h>
 #include <linux/kernel.h>
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------ */
 
 static unsigned int vbi_debug;
diff --git a/drivers/media/pci/saa7134/saa7134-video.c b/drivers/media/pci/saa7134/saa7134-video.c
index 89c1271..6fed99c 100644
--- a/drivers/media/pci/saa7134/saa7134-video.c
+++ b/drivers/media/pci/saa7134/saa7134-video.c
@@ -21,6 +21,8 @@
 #include <media/v4l2-event.h>
 #include <media/i2c/saa6588.h>
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------ */
 
 unsigned int video_debug;
diff --git a/drivers/media/pci/ttpci/av7110_ir.c b/drivers/media/pci/ttpci/av7110_ir.c
index 432789a..7f38b1f 100644
--- a/drivers/media/pci/ttpci/av7110_ir.c
+++ b/drivers/media/pci/ttpci/av7110_ir.c
@@ -10,6 +10,8 @@
 #include <linux/kernel.h>
 #include <media/rc-core.h>
 
+#include <media/compat.h>
+
 #include "av7110.h"
 #include "av7110_hw.h"
 
diff --git a/drivers/media/pci/tw686x/tw686x-core.c b/drivers/media/pci/tw686x/tw686x-core.c
index 74ae4f0..0395d67 100644
--- a/drivers/media/pci/tw686x/tw686x-core.c
+++ b/drivers/media/pci/tw686x/tw686x-core.c
@@ -40,6 +40,8 @@
 #include "tw686x.h"
 #include "tw686x-regs.h"
 
+#include <media/compat.h>
+
 /*
  * This module parameter allows to control the DMA_TIMER_INTERVAL value.
  * The DMA_TIMER_INTERVAL register controls the minimum DMA interrupt
diff --git a/drivers/media/platform/vim2m.c b/drivers/media/platform/vim2m.c
index acd3bd4..d388e68 100644
--- a/drivers/media/platform/vim2m.c
+++ b/drivers/media/platform/vim2m.c
@@ -32,6 +32,8 @@
 #include <media/v4l2-event.h>
 #include <media/videobuf2-vmalloc.h>
 
+#include <media/compat.h>
+
 MODULE_DESCRIPTION("Virtual device for mem2mem framework testing");
 MODULE_AUTHOR("Pawel Osciak, <pawel@osciak.com>");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/radio/radio-cadet.c b/drivers/media/radio/radio-cadet.c
index a5db9b4..7ff3daf 100644
--- a/drivers/media/radio/radio-cadet.c
+++ b/drivers/media/radio/radio-cadet.c
@@ -46,6 +46,8 @@
 #include <media/v4l2-fh.h>
 #include <media/v4l2-event.h>
 
+#include <media/compat.h>
+
 MODULE_AUTHOR("Fred Gleason, Russell Kroll, Quay Lu, Donald Song, Jason Lewis, Scott McGrath, William McGrath");
 MODULE_DESCRIPTION("A driver for the ADS Cadet AM/FM/RDS radio card.");
 MODULE_LICENSE("GPL");
diff --git a/drivers/media/radio/wl128x/fmdrv_common.c b/drivers/media/radio/wl128x/fmdrv_common.c
index cce97c9..6a58998 100644
--- a/drivers/media/radio/wl128x/fmdrv_common.c
+++ b/drivers/media/radio/wl128x/fmdrv_common.c
@@ -22,6 +22,9 @@
 #include <linux/module.h>
 #include <linux/firmware.h>
 #include <linux/delay.h>
+
+#include <media/compat.h>
+
 #include "fmdrv.h"
 #include "fmdrv_v4l2.h"
 #include "fmdrv_common.h"
@@ -407,7 +410,7 @@ static int fm_send_cmd(struct fmdev *fmdev, u8 fm_op, u16 type,	void *payload,
 	if (!test_bit(FM_FW_DW_INPROGRESS, &fmdev->flag) ||
 			test_bit(FM_INTTASK_RUNNING, &fmdev->flag)) {
 		/* Fill command header info */
-		hdr = skb_put(skb, FM_CMD_MSG_HDR_SIZE);
+		hdr = (void*)skb_put(skb, FM_CMD_MSG_HDR_SIZE);
 		hdr->hdr = FM_PKT_LOGICAL_CHAN_NUMBER;	/* 0x08 */
 
 		/* 3 (fm_opcode,rd_wr,dlen) + payload len) */
diff --git a/drivers/media/rc/ene_ir.c b/drivers/media/rc/ene_ir.c
index 75632e7..a8e12d4 100644
--- a/drivers/media/rc/ene_ir.c
+++ b/drivers/media/rc/ene_ir.c
@@ -28,6 +28,8 @@
 #include <media/rc-core.h>
 #include "ene_ir.h"
 
+#include <media/compat.h>
+
 static int sample_period;
 static bool learning_mode_force;
 static int debug;
diff --git a/drivers/media/rc/igorplugusb.c b/drivers/media/rc/igorplugusb.c
index b981f72..c262fc2 100644
--- a/drivers/media/rc/igorplugusb.c
+++ b/drivers/media/rc/igorplugusb.c
@@ -18,6 +18,8 @@
 #include <linux/usb/input.h>
 #include <media/rc-core.h>
 
+#include <media/compat.h>
+
 #define DRIVER_DESC		"IgorPlug-USB IR Receiver"
 #define DRIVER_NAME		"igorplugusb"
 
diff --git a/drivers/media/rc/imon.c b/drivers/media/rc/imon.c
index 0c2313e..a636328 100644
--- a/drivers/media/rc/imon.c
+++ b/drivers/media/rc/imon.c
@@ -32,6 +32,8 @@
 
 #include <linux/timer.h>
 
+#include <media/compat.h>
+
 #define MOD_AUTHOR	"Jarod Wilson <jarod@wilsonet.com>"
 #define MOD_DESC	"Driver for SoundGraph iMON MultiMedia IR/Display"
 #define MOD_NAME	"imon"
diff --git a/drivers/media/rc/ir-mce_kbd-decoder.c b/drivers/media/rc/ir-mce_kbd-decoder.c
index cfe837f..d4abc98 100644
--- a/drivers/media/rc/ir-mce_kbd-decoder.c
+++ b/drivers/media/rc/ir-mce_kbd-decoder.c
@@ -10,6 +10,8 @@
 
 #include "rc-core-priv.h"
 
+#include <media/compat.h>
+
 /*
  * This decoder currently supports:
  * - MCIR-2 29-bit IR signals used for mouse movement and buttons
diff --git a/drivers/media/rc/lirc_dev.c b/drivers/media/rc/lirc_dev.c
index b7a0588..bf1620a 100644
--- a/drivers/media/rc/lirc_dev.c
+++ b/drivers/media/rc/lirc_dev.c
@@ -17,6 +17,8 @@
 #include <linux/sched.h>
 #include <linux/wait.h>
 
+#include <media/compat.h>
+
 #include "rc-core-priv.h"
 #include <uapi/linux/lirc.h>
 
diff --git a/drivers/media/rc/rc-ir-raw.c b/drivers/media/rc/rc-ir-raw.c
index 39dd46b..bd4685c 100644
--- a/drivers/media/rc/rc-ir-raw.c
+++ b/drivers/media/rc/rc-ir-raw.c
@@ -10,6 +10,8 @@
 #include <linux/sched.h>
 #include "rc-core-priv.h"
 
+#include <media/compat.h>
+
 /* Used to keep track of IR raw clients, protected by ir_raw_handler_lock */
 static LIST_HEAD(ir_raw_client_list);
 
diff --git a/drivers/media/rc/rc-main.c b/drivers/media/rc/rc-main.c
index bbe5ad1..8c8a638 100644
--- a/drivers/media/rc/rc-main.c
+++ b/drivers/media/rc/rc-main.c
@@ -18,6 +18,8 @@
 #include <linux/module.h>
 #include "rc-core-priv.h"
 
+#include <media/compat.h>
+
 /* Sizes are in bytes, 256 bytes allows for 32 entries on x64 */
 #define IR_TAB_MIN_SIZE	256
 #define IR_TAB_MAX_SIZE	8192
diff --git a/drivers/media/rc/serial_ir.c b/drivers/media/rc/serial_ir.c
index d71bcf7..fddc7de 100644
--- a/drivers/media/rc/serial_ir.c
+++ b/drivers/media/rc/serial_ir.c
@@ -27,6 +27,8 @@
 #include <linux/spinlock.h>
 #include <media/rc-core.h>
 
+#include <media/compat.h>
+
 struct serial_ir_hw {
 	int signal_pin;
 	int signal_pin_change;
diff --git a/drivers/media/rc/sir_ir.c b/drivers/media/rc/sir_ir.c
index 5bcd157..fb9e270 100644
--- a/drivers/media/rc/sir_ir.c
+++ b/drivers/media/rc/sir_ir.c
@@ -19,6 +19,8 @@
 
 #include <media/rc-core.h>
 
+#include <media/compat.h>
+
 /* SECTION: Definitions */
 #define PULSE '['
 
diff --git a/drivers/media/usb/au0828/au0828-dvb.c b/drivers/media/usb/au0828/au0828-dvb.c
index 2a8691a..e5d354c 100644
--- a/drivers/media/usb/au0828/au0828-dvb.c
+++ b/drivers/media/usb/au0828/au0828-dvb.c
@@ -19,6 +19,8 @@
 #include "mxl5007t.h"
 #include "tda18271.h"
 
+#include <media/compat.h>
+
 static int preallocate_big_buffers;
 module_param_named(preallocate_big_buffers, preallocate_big_buffers, int, 0644);
 MODULE_PARM_DESC(preallocate_big_buffers, "Preallocate the larger transfer buffers at module load time");
diff --git a/drivers/media/usb/au0828/au0828-video.c b/drivers/media/usb/au0828/au0828-video.c
index 5e00019..e73081e 100644
--- a/drivers/media/usb/au0828/au0828-video.c
+++ b/drivers/media/usb/au0828/au0828-video.c
@@ -27,6 +27,8 @@
 #include <media/tuner.h>
 #include "au0828-reg.h"
 
+#include <media/compat.h>
+
 static DEFINE_MUTEX(au0828_sysfs_lock);
 
 /* ------------------------------------------------------------------
diff --git a/drivers/media/usb/em28xx/em28xx-dvb.c b/drivers/media/usb/em28xx/em28xx-dvb.c
index b3d38d1..a98d405 100644
--- a/drivers/media/usb/em28xx/em28xx-dvb.c
+++ b/drivers/media/usb/em28xx/em28xx-dvb.c
@@ -44,7 +44,7 @@
 #include "mt352.h"
 #include "mt352_priv.h" /* FIXME */
 #include "tda1002x.h"
-#include "drx39xxj.h"
+#include "../../dvb-frontends/drx39xyj/drx39xxj.h"
 #include "tda18271.h"
 #include "s921.h"
 #include "drxd.h"
diff --git a/drivers/media/usb/pvrusb2/pvrusb2-hdw.c b/drivers/media/usb/pvrusb2/pvrusb2-hdw.c
index 9579131..46741ff 100644
--- a/drivers/media/usb/pvrusb2/pvrusb2-hdw.c
+++ b/drivers/media/usb/pvrusb2/pvrusb2-hdw.c
@@ -38,6 +38,8 @@
 #include "pvrusb2-cs53l32a.h"
 #include "pvrusb2-audio.h"
 
+#include <media/compat.h>
+
 #define TV_MIN_FREQ     55250000L
 #define TV_MAX_FREQ    850000000L
 
@@ -3670,12 +3672,14 @@ static int pvr2_send_request_ex(struct pvr2_hdw *hdw,
 				  hdw);
 		hdw->ctl_write_urb->actual_length = 0;
 		hdw->ctl_write_pend_flag = !0;
+#if 0 /* reverse 72c27a68a2 */
 		if (usb_urb_ep_type_check(hdw->ctl_write_urb)) {
 			pvr2_trace(
 				PVR2_TRACE_ERROR_LEGS,
 				"Invalid write control endpoint");
 			return -EINVAL;
 		}
+#endif
 		status = usb_submit_urb(hdw->ctl_write_urb,GFP_KERNEL);
 		if (status < 0) {
 			pvr2_trace(PVR2_TRACE_ERROR_LEGS,
@@ -3700,12 +3704,14 @@ status);
 				  hdw);
 		hdw->ctl_read_urb->actual_length = 0;
 		hdw->ctl_read_pend_flag = !0;
+#if 0 /* reverse 72c27a68a2 */
 		if (usb_urb_ep_type_check(hdw->ctl_read_urb)) {
 			pvr2_trace(
 				PVR2_TRACE_ERROR_LEGS,
 				"Invalid read control endpoint");
 			return -EINVAL;
 		}
+#endif
 		status = usb_submit_urb(hdw->ctl_read_urb,GFP_KERNEL);
 		if (status < 0) {
 			pvr2_trace(PVR2_TRACE_ERROR_LEGS,
diff --git a/drivers/media/usb/s2255/s2255drv.c b/drivers/media/usb/s2255/s2255drv.c
index aa90558..332125b 100644
--- a/drivers/media/usb/s2255/s2255drv.c
+++ b/drivers/media/usb/s2255/s2255drv.c
@@ -40,6 +40,8 @@
 #include <media/v4l2-ctrls.h>
 #include <media/v4l2-event.h>
 
+#include <media/compat.h>
+
 #define S2255_VERSION		"1.25.1"
 #define FIRMWARE_FILE_NAME "f2255usb.bin"
 
diff --git a/drivers/media/usb/uvc/uvc_driver.c b/drivers/media/usb/uvc/uvc_driver.c
index 66ee168..e5b4d61 100644
--- a/drivers/media/usb/uvc/uvc_driver.c
+++ b/drivers/media/usb/uvc/uvc_driver.c
@@ -21,6 +21,8 @@
 #include <media/v4l2-common.h>
 #include <media/v4l2-ioctl.h>
 
+#include <media/compat.h>
+
 #include "uvcvideo.h"
 
 #define DRIVER_AUTHOR		"Laurent Pinchart " \
diff --git a/drivers/media/v4l2-core/v4l2-fwnode.c b/drivers/media/v4l2-core/v4l2-fwnode.c
index c27fff9..9fb2574 100644
--- a/drivers/media/v4l2-core/v4l2-fwnode.c
+++ b/drivers/media/v4l2-core/v4l2-fwnode.c
@@ -28,6 +28,8 @@
 #include <media/v4l2-fwnode.h>
 #include <media/v4l2-subdev.h>
 
+#include <media/compat.h>
+
 enum v4l2_fwnode_bus_type {
 	V4L2_FWNODE_BUS_TYPE_GUESS = 0,
 	V4L2_FWNODE_BUS_TYPE_CSI2_CPHY,
diff --git a/drivers/media/v4l2-core/v4l2-ioctl.c b/drivers/media/v4l2-core/v4l2-ioctl.c
index a10b271..552f35f 100644
--- a/drivers/media/v4l2-core/v4l2-ioctl.c
+++ b/drivers/media/v4l2-core/v4l2-ioctl.c
@@ -29,6 +29,8 @@
 
 #include <trace/events/v4l2.h>
 
+#include <media/compat.h>
+
 /* Zero out the end of the struct pointed to by p.  Everything after, but
  * not including, the specified field is cleared. */
 #define CLEAR_AFTER_FIELD(p, field) \
diff --git a/drivers/media/v4l2-core/videobuf-dma-sg.c b/drivers/media/v4l2-core/videobuf-dma-sg.c
index a1dc49a0..fca7169 100644
--- a/drivers/media/v4l2-core/videobuf-dma-sg.c
+++ b/drivers/media/v4l2-core/videobuf-dma-sg.c
@@ -31,6 +31,8 @@
 
 #include <media/videobuf-dma-sg.h>
 
+#include <media/compat.h>
+
 #define MAGIC_DMABUF 0x19721112
 #define MAGIC_SG_MEM 0x17890714
 
diff --git a/include/media/i2c/saa6588.h b/include/media/i2c/saa6588.h
index bbec05a..d1bb04d 100644
--- a/include/media/i2c/saa6588.h
+++ b/include/media/i2c/saa6588.h
@@ -13,6 +13,8 @@
 #ifndef _SAA6588_H
 #define _SAA6588_H
 
+#include <media/compat.h>
+
 struct saa6588_command {
 	unsigned int  block_count;
 	bool          nonblocking;
diff --git a/include/media/media-devnode.h b/include/media/media-devnode.h
index 6393842..187c64e 100644
--- a/include/media/media-devnode.h
+++ b/include/media/media-devnode.h
@@ -21,6 +21,8 @@
 #include <linux/device.h>
 #include <linux/cdev.h>
 
+#include <media/compat.h>
+
 struct media_device;
 
 /*
diff --git a/include/media/v4l2-ctrls.h b/include/media/v4l2-ctrls.h
index b443348..0eff0eb 100644
--- a/include/media/v4l2-ctrls.h
+++ b/include/media/v4l2-ctrls.h
@@ -21,6 +21,8 @@
 #include <media/fwht-ctrls.h>
 #include <media/h264-ctrls.h>
 
+#include <media/compat.h>
+
 /* forward references */
 struct file;
 struct v4l2_ctrl_handler;
diff --git a/include/media/v4l2-dev.h b/include/media/v4l2-dev.h
index 48531e5..5d5585b 100644
--- a/include/media/v4l2-dev.h
+++ b/include/media/v4l2-dev.h
@@ -19,6 +19,8 @@
 
 #include <media/media-entity.h>
 
+#include <media/compat.h>
+
 #define VIDEO_MAJOR	81
 
 /**
diff --git a/include/media/videobuf-core.h b/include/media/videobuf-core.h
index 2c4db97..8693a06 100644
--- a/include/media/videobuf-core.h
+++ b/include/media/videobuf-core.h
@@ -19,6 +19,8 @@
 #include <linux/poll.h>
 #include <linux/videodev2.h>
 
+#include <media/compat.h>
+
 #define UNSET (-1U)
 
 
-- 
2.7.4

