From 3dd5645880425d8ec6abd0d739d08fd63e77ff09 Mon Sep 17 00:00:00 2001
From: Brad Love <brad@nextdimension.cc>
Date: Fri, 17 Mar 2017 01:36:44 +0000
Subject: [PATCH 2/7] Apply build fixes to media tree

---
 drivers/media/cec/cec-core.c                   | 2 ++
 drivers/media/dvb-frontends/af9033.c           | 2 ++
 drivers/media/media-device.c                   | 2 ++
 drivers/media/pci/ivtv/ivtv-driver.c           | 2 ++
 drivers/media/pci/ivtv/ivtv-irq.c              | 2 ++
 drivers/media/rc/keymaps/rc-cec.c              | 2 ++
 drivers/media/usb/em28xx/em28xx-dvb.c          | 2 +-
 drivers/media/usb/pulse8-cec/pulse8-cec.c      | 2 ++
 drivers/media/usb/usbtv/usbtv-core.c           | 2 ++
 drivers/media/usb/uvc/uvc_driver.c             | 2 ++
 drivers/media/usb/uvc/uvc_video.c              | 2 ++
 drivers/media/v4l2-core/v4l2-async.c           | 2 ++
 drivers/media/v4l2-core/v4l2-flash-led-class.c | 2 ++
 drivers/media/v4l2-core/v4l2-ioctl.c           | 2 ++
 include/linux/kconfig.h                        | 5 +++--
 15 files changed, 30 insertions(+), 3 deletions(-)

diff --git a/drivers/media/cec/cec-core.c b/drivers/media/cec/cec-core.c
index 37217e2..5278119 100644
--- a/drivers/media/cec/cec-core.c
+++ b/drivers/media/cec/cec-core.c
@@ -29,6 +29,8 @@
 
 #include "cec-priv.h"
 
+#include <media/compat.h>
+
 #define CEC_NUM_DEVICES	256
 #define CEC_NAME	"cec"
 
diff --git a/drivers/media/dvb-frontends/af9033.c b/drivers/media/dvb-frontends/af9033.c
index aaed7cf..1631b9a 100644
--- a/drivers/media/dvb-frontends/af9033.c
+++ b/drivers/media/dvb-frontends/af9033.c
@@ -15,6 +15,8 @@
  *    GNU General Public License for more details.
  */
 
+#include <media/compat.h>
+
 #include "af9033_priv.h"
 
 struct af9033_dev {
diff --git a/drivers/media/media-device.c b/drivers/media/media-device.c
index b188787..9c12426 100644
--- a/drivers/media/media-device.c
+++ b/drivers/media/media-device.c
@@ -33,6 +33,8 @@
 #include <media/media-devnode.h>
 #include <media/media-entity.h>
 
+#include <media/compat.h>
+
 #ifdef CONFIG_MEDIA_CONTROLLER
 
 /* -----------------------------------------------------------------------------
diff --git a/drivers/media/pci/ivtv/ivtv-driver.c b/drivers/media/pci/ivtv/ivtv-driver.c
index aaccc11..a879c0d 100644
--- a/drivers/media/pci/ivtv/ivtv-driver.c
+++ b/drivers/media/pci/ivtv/ivtv-driver.c
@@ -60,6 +60,8 @@
 #include <media/i2c/saa7115.h>
 #include "tuner-xc2028.h"
 
+#include <media/compat.h>
+
 /* If you have already X v4l cards, then set this to X. This way
    the device numbers stay matched. Example: you have a WinTV card
    without radio and a PVR-350 with. Normally this would give a
diff --git a/drivers/media/pci/ivtv/ivtv-irq.c b/drivers/media/pci/ivtv/ivtv-irq.c
index 6efe1f7..93153d8 100644
--- a/drivers/media/pci/ivtv/ivtv-irq.c
+++ b/drivers/media/pci/ivtv/ivtv-irq.c
@@ -27,6 +27,8 @@
 #include "ivtv-yuv.h"
 #include <media/v4l2-event.h>
 
+#include <media/compat.h>
+
 #define DMA_MAGIC_COOKIE 0x000001fe
 
 static void ivtv_dma_dec_start(struct ivtv_stream *s);
diff --git a/drivers/media/rc/keymaps/rc-cec.c b/drivers/media/rc/keymaps/rc-cec.c
index 354c8e7..3ab5d41 100644
--- a/drivers/media/rc/keymaps/rc-cec.c
+++ b/drivers/media/rc/keymaps/rc-cec.c
@@ -11,6 +11,8 @@
 #include <media/rc-map.h>
 #include <linux/module.h>
 
+#include <media/compat.h>
+
 /*
  * CEC Spec "High-Definition Multimedia Interface Specification" can be obtained
  * here: http://xtreamerdev.googlecode.com/files/CEC_Specs.pdf
diff --git a/drivers/media/usb/em28xx/em28xx-dvb.c b/drivers/media/usb/em28xx/em28xx-dvb.c
index 20407a5..1fb9926 100644
--- a/drivers/media/usb/em28xx/em28xx-dvb.c
+++ b/drivers/media/usb/em28xx/em28xx-dvb.c
@@ -44,7 +44,7 @@
 #include "mt352.h"
 #include "mt352_priv.h" /* FIXME */
 #include "tda1002x.h"
-#include "drx39xxj.h"
+#include "../../dvb-frontends/drx39xyj/drx39xxj.h"
 #include "tda18271.h"
 #include "s921.h"
 #include "drxd.h"
diff --git a/drivers/media/usb/pulse8-cec/pulse8-cec.c b/drivers/media/usb/pulse8-cec/pulse8-cec.c
index 7c18dae..9b61660 100644
--- a/drivers/media/usb/pulse8-cec/pulse8-cec.c
+++ b/drivers/media/usb/pulse8-cec/pulse8-cec.c
@@ -44,6 +44,8 @@
 #include <linux/time.h>
 #include <linux/delay.h>
 
+#include <media/compat.h>
+
 #include <media/cec.h>
 
 MODULE_AUTHOR("Hans Verkuil <hverkuil@xs4all.nl>");
diff --git a/drivers/media/usb/usbtv/usbtv-core.c b/drivers/media/usb/usbtv/usbtv-core.c
index ceb953b..92216c9 100644
--- a/drivers/media/usb/usbtv/usbtv-core.c
+++ b/drivers/media/usb/usbtv/usbtv-core.c
@@ -44,6 +44,8 @@
 
 #include "usbtv.h"
 
+#include <media/compat.h>
+
 int usbtv_set_regs(struct usbtv *usbtv, const u16 regs[][2], int size)
 {
 	int ret;
diff --git a/drivers/media/usb/uvc/uvc_driver.c b/drivers/media/usb/uvc/uvc_driver.c
index 3056300..a11c9bd 100644
--- a/drivers/media/usb/uvc/uvc_driver.c
+++ b/drivers/media/usb/uvc/uvc_driver.c
@@ -27,6 +27,8 @@
 
 #include "uvcvideo.h"
 
+#include <media/compat.h>
+
 #define DRIVER_AUTHOR		"Laurent Pinchart " \
 				"<laurent.pinchart@ideasonboard.com>"
 #define DRIVER_DESC		"USB Video Class driver"
diff --git a/drivers/media/usb/uvc/uvc_video.c b/drivers/media/usb/uvc/uvc_video.c
index 7f0d811..32a0527 100644
--- a/drivers/media/usb/uvc/uvc_video.c
+++ b/drivers/media/usb/uvc/uvc_video.c
@@ -26,6 +26,8 @@
 
 #include "uvcvideo.h"
 
+#include <media/compat.h>
+
 /* ------------------------------------------------------------------------
  * UVC Controls
  */
diff --git a/drivers/media/v4l2-core/v4l2-async.c b/drivers/media/v4l2-core/v4l2-async.c
index 96cc733..a4cc493 100644
--- a/drivers/media/v4l2-core/v4l2-async.c
+++ b/drivers/media/v4l2-core/v4l2-async.c
@@ -22,6 +22,8 @@
 #include <media/v4l2-device.h>
 #include <media/v4l2-subdev.h>
 
+#include <media/compat.h>
+
 static bool match_i2c(struct v4l2_subdev *sd, struct v4l2_async_subdev *asd)
 {
 #if IS_ENABLED(CONFIG_I2C)
diff --git a/drivers/media/v4l2-core/v4l2-flash-led-class.c b/drivers/media/v4l2-core/v4l2-flash-led-class.c
index 794e563..73831f6 100644
--- a/drivers/media/v4l2-core/v4l2-flash-led-class.c
+++ b/drivers/media/v4l2-core/v4l2-flash-led-class.c
@@ -17,6 +17,8 @@
 #include <linux/types.h>
 #include <media/v4l2-flash-led-class.h>
 
+#include <media/compat.h>
+
 #define has_flash_op(v4l2_flash, op)				\
 	(v4l2_flash && v4l2_flash->ops->op)
 
diff --git a/drivers/media/v4l2-core/v4l2-ioctl.c b/drivers/media/v4l2-core/v4l2-ioctl.c
index f1cdc3d..e6c41a8 100644
--- a/drivers/media/v4l2-core/v4l2-ioctl.c
+++ b/drivers/media/v4l2-core/v4l2-ioctl.c
@@ -31,6 +31,8 @@
 
 #include <trace/events/v4l2.h>
 
+#include <media/compat.h>
+
 /* Zero out the end of the struct pointed to by p.  Everything after, but
  * not including, the specified field is cleared. */
 #define CLEAR_AFTER_FIELD(p, field) \
diff --git a/include/linux/kconfig.h b/include/linux/kconfig.h
index 4d74860..7279f68 100644
--- a/include/linux/kconfig.h
+++ b/include/linux/kconfig.h
@@ -31,6 +31,7 @@
  * When CONFIG_BOOGER is not defined, we generate a (... 1, 0) pair, and when
  * the last step cherry picks the 2nd arg, we get a zero.
  */
+#define config_enabled(cfg)		___is_defined(cfg)
 #define __is_defined(x)			___is_defined(x)
 #define ___is_defined(val)		____is_defined(__ARG_PLACEHOLDER_##val)
 #define ____is_defined(arg1_or_junk)	__take_second_arg(arg1_or_junk 1, 0)
@@ -40,13 +41,13 @@
  * otherwise. For boolean options, this is equivalent to
  * IS_ENABLED(CONFIG_FOO).
  */
-#define IS_BUILTIN(option) __is_defined(option)
+#define IS_BUILTIN(option) config_enabled(option)
 
 /*
  * IS_MODULE(CONFIG_FOO) evaluates to 1 if CONFIG_FOO is set to 'm', 0
  * otherwise.
  */
-#define IS_MODULE(option) __is_defined(option##_MODULE)
+#define IS_MODULE(option) config_enabled(option##_MODULE)
 
 /*
  * IS_REACHABLE(CONFIG_FOO) evaluates to 1 if the currently compiled
-- 
2.7.4

